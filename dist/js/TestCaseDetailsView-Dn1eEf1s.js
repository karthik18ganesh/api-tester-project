import{j as e}from"./chunk-xjDKe2wf.js";import{r as s}from"./chunk-D8-U-K1F.js";import{a5 as t,a6 as r,a3 as a,a4 as n,ac as i,a as d}from"../assets/index-D4o8k9mI.js";import"./chunk-CALic51h.js";import{B as l}from"./chunk-cQr1oPk4.js";import"./chunk-SnPUoUoO.js";import"./chunk-SIvHljHK.js";const o=({children:t,title:a,defaultOpen:n=!1})=>{const[i,l]=s.useState(n);return e.jsxs("div",{className:"border rounded",children:[e.jsxs("button",{className:"w-full flex items-center justify-between p-3 text-left text-sm font-medium bg-gray-50 focus:outline-none",onClick:()=>l(!i),children:[e.jsx("span",{children:a}),i?e.jsx(d,{className:"h-4 w-4 text-gray-500"}):e.jsx(r,{className:"h-4 w-4 text-gray-500"})]}),i&&e.jsx("div",{className:"p-3 border-t",children:t})]})},c=({executionId:d,testCaseId:c,onBack:x})=>{const[u,m]=s.useState(null),[h,g]=s.useState(null),[b,j]=s.useState(!0),[p,f]=s.useState(0),[N,y]=s.useState(null);s.useEffect((()=>{d&&c&&(async()=>{j(!0),y(null);try{const s=window.mockExecutionData?.[d];if(s){m(s);const e=s.results.findIndex((e=>e.id===c));-1!==e?(g(s.results[e]),f(e)):y("Test case not found in execution results")}else{const s=d.replace("exec-","");try{const e=await i.getExecutionDetails(s),t=e.testCaseResults||[],r=t.find((e=>`tc-${e.testCaseId}`===c));if(!r)return void y("Test case not found in execution results");const a={id:c,name:r.testCaseName||"API Test Case",status:"PASSED"===r.executionStatus?"Passed":"Failed",duration:`${r.executionTimeMs||0}ms`,request:{method:r.httpMethod,url:r.url,headers:r.requestHeaders||{},body:r.requestBody},response:{status:r.statusCode,data:r.responseBody,headers:r.responseHeaders||{}},assertions:[{id:1,description:"HTTP Status Code Validation",status:"PASSED"===r.executionStatus?"Passed":"Failed",..."PASSED"!==r.executionStatus&&{error:r.errorMessage||`Expected successful response but got status ${r.statusCode}`}},{id:2,description:"Response Time Validation",status:r.executionTimeMs<=5e3?"Passed":"Failed",...r.executionTimeMs>5e3&&{error:`Response time ${r.executionTimeMs}ms exceeded 5000ms limit`}}],executedBy:e.executedBy,executionDate:e.executionDate,testSuiteId:r.testSuiteId,testSuiteName:r.testSuiteName},n={id:d,status:"PASSED"===e.executionStatus?"Passed":"Failed",instanceId:d,executedBy:e.executedBy,environment:e.environmentName||"API Environment",executedAt:v(e.executionDate),passedCount:e.executionSummary?.passedTests||0,failedCount:e.executionSummary?.failedTests||0,results:t.map(((e,s)=>({id:`tc-${e.testCaseId}`,name:e.testCaseName||`Test Case ${s+1}`,status:"PASSED"===e.executionStatus?"Passed":"Failed",duration:`${e.executionTimeMs||0}ms`})))};m(n),g(a);const l=n.results.findIndex((e=>e.id===c));f(-1!==l?l:0)}catch(e){y("Failed to load test case details from API")}}}catch(s){y("Failed to load test case details")}finally{j(!1)}})()}),[d,c]);const v=e=>{if(!e)return"Unknown";try{return new Date(e.replace(" ","T")).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch(s){return e}},w=e=>{if(!u||!u.results||0===u.results.length)return;let s;s="next"===e?(p+1)%u.results.length:(p-1+u.results.length)%u.results.length;const t=u.results[s];window.history.pushState(null,"",`/test-execution/results/${d}/${t.id}`),window.location.reload()},S=e=>{try{if("string"==typeof e)try{const s=JSON.parse(e);return JSON.stringify(s,null,2)}catch{return e}return JSON.stringify(e,null,2)}catch(s){return String(e)}};if(b)return e.jsx("div",{className:"p-6 bg-gray-50 min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4 inline-block"}),e.jsx("p",{className:"text-gray-600",children:"Loading test case details..."})]})});if(N||!h||!u)return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsx(l,{items:[{label:"Test Execution"},{label:"Test Results",path:"/test-results"},{label:`Execution ${d}`,path:`/test-execution/results/${d}`},{label:"Test Case Details"}]}),e.jsx("div",{className:"flex items-center mb-6",children:e.jsxs("button",{onClick:x,className:"flex items-center text-indigo-600 hover:text-indigo-800 transition-colors",children:[e.jsx(t,{className:"mr-2"}),"Back to Execution Results"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-10 text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:N||"Test case not found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:N?"There was an error loading the test case details.":"The test case you're looking for doesn't exist or has been removed."}),e.jsx("button",{onClick:x,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Go Back to Execution Results"})]})]});const k=(()=>{if(!h?.assertions||0===h.assertions.length)return 0;const e=h.assertions.filter((e=>"Passed"===e.status)).length;return Math.round(e/h.assertions.length*100)})();return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:x,className:"flex items-center text-indigo-600 hover:text-indigo-800 transition-colors",children:[e.jsx(t,{className:"mr-2"}),"Back to Execution Results"]}),u.results&&u.results.length>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>w("prev"),className:"p-2 rounded-md border border-gray-200 hover:bg-gray-50 text-gray-600",title:"Previous test case",children:e.jsx(t,{size:14})}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Test ",p+1," of ",u.results.length]}),e.jsx("button",{onClick:()=>w("next"),className:"p-2 rounded-md border border-gray-200 hover:bg-gray-50 text-gray-600",title:"Next test case",children:e.jsx(r,{size:14})})]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-1 text-gray-800",children:h.name}),e.jsxs("p",{className:"text-gray-600",children:["Execution ID: ",d]}),h.testSuiteName&&e.jsxs("p",{className:"text-gray-500 text-sm",children:["Suite: ",h.testSuiteName]})]}),e.jsx("div",{className:`px-3 py-1 rounded-md text-white ${"Passed"===h.status?"bg-green-500":"bg-red-500"} shadow-sm`,children:h.status})]}),e.jsx("div",{className:"mb-6 bg-gray-100 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:`h-full ${"Passed"===h.status?"bg-green-500":"bg-red-500"} transition-all duration-500 ease-in-out`,style:{width:`${k}%`}})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"border rounded-lg shadow-sm p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:"Request"}),e.jsx("span",{className:"bg-indigo-100 text-indigo-700 text-xs px-2 py-1 rounded-full",children:h.request?.method||"GET"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"URL"}),e.jsx("div",{className:"bg-gray-50 p-2 rounded border border-gray-100 font-mono text-sm break-all",children:h.request?.url||"No URL provided"})]}),h.request?.headers&&Object.keys(h.request.headers).length>0&&e.jsx("div",{className:"mb-3",children:e.jsx(o,{title:"Headers",defaultOpen:!1,children:e.jsx("pre",{className:"bg-gray-50 p-3 rounded font-mono text-sm overflow-auto border border-gray-100 max-h-60",children:S(h.request.headers)})})}),h.request?.body&&e.jsx("div",{children:e.jsx(o,{title:"Request Body",defaultOpen:!1,children:e.jsx("pre",{className:"bg-gray-50 p-3 rounded font-mono text-sm overflow-auto border border-gray-100 max-h-60",children:S(h.request.body)})})})]}),e.jsxs("div",{className:"border rounded-lg shadow-sm p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:"Response"}),e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full "+(h.response?.status>=200&&h.response?.status<300?"bg-green-100 text-green-800":h.response?.status>=400?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:["Status: ",h.response?.status||"Unknown"]})]}),h.response?.data&&e.jsx("div",{children:e.jsx(o,{title:"Response Body",defaultOpen:!0,children:e.jsx("pre",{className:"bg-gray-50 p-3 rounded font-mono text-sm overflow-auto border border-gray-100 max-h-60",children:S(h.response.data)})})}),h.response?.headers&&Object.keys(h.response.headers).length>0&&e.jsx("div",{className:"mt-3",children:e.jsx(o,{title:"Response Headers",defaultOpen:!1,children:e.jsx("pre",{className:"bg-gray-50 p-3 rounded font-mono text-sm overflow-auto border border-gray-100 max-h-60",children:S(h.response.headers)})})})]})]}),e.jsxs("div",{className:"border rounded-lg shadow-sm overflow-hidden bg-white mb-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 border-b",children:e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:"Assertions"})}),e.jsxs("div",{className:"divide-y divide-gray-100",children:[h.assertions&&h.assertions.map((s=>e.jsx("div",{className:"p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"mt-0.5 rounded-full p-1 mr-3 "+("Passed"===s.status?"bg-green-100 text-green-600":"bg-red-100 text-red-600"),children:"Passed"===s.status?e.jsx(a,{className:"h-4 w-4"}):e.jsx(n,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["Assertion #",s.id]}),e.jsx("div",{className:"text-gray-600 mt-1",children:s.description}),"Passed"!==s.status&&s.error&&e.jsx("div",{className:"mt-2 bg-red-50 text-red-700 p-2 rounded text-sm border border-red-100",children:s.error})]})]}),e.jsx("div",{children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("Passed"===s.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:s.status})})]})},s.id))),(!h.assertions||0===h.assertions.length)&&e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No assertions found for this test case"})]})]}),e.jsxs("div",{className:"border rounded-lg shadow-sm overflow-hidden bg-white mb-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 border-b",children:e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:"Execution Details"})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Duration"}),e.jsx("div",{className:"font-medium",children:h.duration})]}),h.executedBy&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Executed By"}),e.jsx("div",{className:"font-medium",children:h.executedBy})]}),h.executionDate&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Execution Date"}),e.jsx("div",{className:"font-medium",children:v(h.executionDate)})]}),u.environment&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Environment"}),e.jsx("div",{className:"font-medium",children:u.environment})]})]})})]}),h.snippets&&e.jsxs("div",{className:"border rounded-lg shadow-sm overflow-hidden bg-white",children:[e.jsxs("div",{className:"bg-gray-50 p-4 border-b flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"})}),e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:"Code Snippets"})]}),e.jsx("div",{className:"p-4",children:e.jsx(o,{title:"Test Code",defaultOpen:!1,children:e.jsx("pre",{className:"bg-gray-50 p-3 rounded font-mono text-sm overflow-auto border border-gray-100",children:h.snippets.testCode||"// No test code available"})})})]})]})};export{c as default};
