import{j as e}from"./chunk-BonG-WPQ.js";import{r as s}from"./chunk-C74fWxxE.js";import{p as t,c as a,T as r,o as d,v as n,X as l,ae as i,af as c,ag as o,ac as x,am as m,a as u}from"../assets/index-BIbMNroQ.js";import"./chunk-Dw5YO7VD.js";import{B as h}from"./chunk-Bq23yqQC.js";import{g,a as j}from"./chunk-DvM4gKK_.js";import"./chunk-SnPUoUoO.js";import"./chunk-4QNEI4IN.js";const b=({assertions:s=[],summary:i=null,compact:c=!1})=>{const o=s=>{switch(s){case"Passed":case"PASSED":return e.jsx(t,{className:"w-4 h-4 text-green-600"});case"Failed":case"FAILED":return e.jsx(a,{className:"w-4 h-4 text-red-600"});case"ERROR":return e.jsx(n,{className:"w-4 h-4 text-orange-600"});default:return e.jsx(d,{className:"w-4 h-4 text-gray-400"})}},x=e=>{switch(e){case"Passed":case"PASSED":return"text-green-700 bg-green-50 border-green-200";case"Failed":case"FAILED":return"text-red-700 bg-red-50 border-red-200";case"ERROR":return"text-orange-700 bg-orange-50 border-orange-200";default:return"text-gray-700 bg-gray-50 border-gray-200"}},m=s=>{switch(s){case"json_path":return e.jsx(r,{className:"w-3 h-3"});case"status_code":return e.jsx(l,{className:"w-3 h-3"});case"response_time":return e.jsx(d,{className:"w-3 h-3"});default:return e.jsx(t,{className:"w-3 h-3"})}};return c&&i?e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(t,{className:"w-3 h-3 text-green-600"}),e.jsx("span",{className:"text-green-700",children:i.passed})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(a,{className:"w-3 h-3 text-red-600"}),e.jsx("span",{className:"text-red-700",children:i.failed})]}),e.jsxs("span",{className:"text-gray-500",children:["(",i.total," total)"]}),e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-green-500 h-1.5 rounded-full",style:{width:`${i.successRate}%`}})}),e.jsxs("span",{className:"text-xs text-gray-500",children:[i.successRate,"%"]})]}):e.jsxs("div",{className:"space-y-4",children:[i&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Assertion Summary"}),e.jsx("div",{className:"flex items-center gap-2 text-sm",children:e.jsxs("span",{className:"px-2 py-1 rounded-full "+(100===i.successRate?"bg-green-100 text-green-700":i.successRate>=70?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"),children:[i.successRate,"% Success Rate"]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{className:"bg-white rounded p-3 border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:i.passed}),e.jsx("div",{className:"text-sm text-gray-600",children:"Passed"})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:i.failed}),e.jsx("div",{className:"text-sm text-gray-600",children:"Failed"})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:i.total}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(r,{className:"w-4 h-4"}),"Assertion Details (",s.length,")"]}),0===s.length?e.jsxs("div",{className:"bg-blue-50 rounded-lg p-6 border border-blue-200",children:[e.jsx("h3",{className:"text-lg font-medium text-blue-900 mb-2",children:"Test Executed Successfully"}),e.jsx("p",{className:"text-blue-700 mb-4",children:"This test case executed but had no assertions to validate the response."}),e.jsx("div",{className:"text-sm text-blue-800",children:"Consider adding assertions to validate response data, status codes, or performance metrics."})]}):s.map(((s,t)=>e.jsx("div",{className:`border rounded-lg p-4 ${x(s.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o(s.status),e.jsx("span",{className:"font-medium text-gray-900",children:s.name||s.description||`Assertion ${t+1}`}),s.type&&"system"!==s.type&&e.jsxs("span",{className:"flex items-center gap-1 text-xs bg-white px-2 py-1 rounded-full border",children:[m(s.type),s.type.replace(/_/g," ")]})]}),s.path&&e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Target:"}),e.jsx("code",{className:"ml-1 bg-white px-1 rounded text-xs",children:s.path})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[void 0!==s.expectedValue&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Expected:"}),e.jsx("div",{className:"mt-1 p-2 bg-white rounded border text-xs font-mono break-all",children:JSON.stringify(s.expectedValue)})]}),void 0!==s.actualValue&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Actual:"}),e.jsx("div",{className:"mt-1 p-2 bg-white rounded border text-xs font-mono break-all",children:JSON.stringify(s.actualValue)})]})]}),s.error&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded text-sm",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(a,{className:"w-4 h-4 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-red-900 mb-1",children:"Error Details"}),e.jsx("div",{className:"text-red-700",children:s.error})]})]})})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 ml-4",children:[e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("Passed"===s.status||"PASSED"===s.status?"bg-green-100 text-green-700":"Failed"===s.status||"FAILED"===s.status?"bg-red-100 text-red-700":"bg-orange-100 text-orange-700"),children:s.status}),void 0!==s.executionTime&&e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(d,{className:"w-3 h-3"}),s.executionTime,"ms"]})]})]})},s.id||t)))]})]})},p=({children:t,title:a,defaultOpen:r=!1})=>{const[d,n]=s.useState(r);return e.jsxs("div",{className:"border rounded",children:[e.jsxs("button",{className:"w-full flex items-center justify-between p-3 text-left text-sm font-medium bg-gray-50 focus:outline-none",onClick:()=>n(!d),children:[e.jsx("span",{children:a}),d?e.jsx(u,{className:"h-4 w-4 text-gray-500"}):e.jsx(c,{className:"h-4 w-4 text-gray-500"})]}),d&&e.jsx("div",{className:"p-3 border-t",children:t})]})},N=({executionId:t,testCaseId:a,onBack:r})=>{const[d,n]=s.useState(null),[l,u]=s.useState(null),[N,y]=s.useState(!0),[f,v]=s.useState(0),[w,S]=s.useState(null);s.useEffect((()=>{t&&a&&(async()=>{y(!0),S(null);try{const s=window.mockExecutionData?.[t];if(s){n(s);const e=s.results.findIndex((e=>e.id===a));-1!==e?(u(s.results[e]),v(e)):S("Test case not found in execution results")}else{const s=t.replace("exec-","");try{const e=await m.getExecutionDetails(s),r=e.testCaseResults||[],d=r.find((e=>`tc-${e.testCaseId}`===a));if(!d)return void S("Test case not found in execution results");const l={id:a,name:d.testCaseName||"API Test Case",status:"PASSED"===d.executionStatus?"Passed":"Failed",duration:`${d.executionTimeMs||0}ms`,request:{method:d.httpMethod,url:d.url,headers:d.requestHeaders||{},body:d.requestBody},response:{status:d.statusCode,data:d.responseBody,headers:d.responseHeaders||{}},assertionResults:d.assertionResults&&Array.isArray(d.assertionResults)?d.assertionResults:[],assertionSummary:d.assertionSummary||{total:0,passed:0,failed:0,skipped:0},assertions:d.assertionResults&&Array.isArray(d.assertionResults)?d.assertionResults.map(((e,s)=>({id:e.assertionId||s+1,description:e.assertionName||"Assertion",status:"PASSED"===e.status?"Passed":"Failed",..."PASSED"!==e.status&&e.errorMessage&&{error:e.errorMessage}}))):[],executedBy:e.executedBy,executionDate:e.executionDate,testSuiteId:d.testSuiteId,testSuiteName:d.testSuiteName},i={id:t,status:"PASSED"===e.executionStatus?"Passed":"Failed",instanceId:t,executedBy:e.executedBy,environment:e.environmentName||"API Environment",executedAt:E(e.executionDate),passedCount:e.executionSummary?.passedTests||0,failedCount:e.executionSummary?.failedTests||0,results:r.map(((e,s)=>({id:`tc-${e.testCaseId}`,name:e.testCaseName||`Test Case ${s+1}`,status:"PASSED"===e.executionStatus?"Passed":"Failed",duration:`${e.executionTimeMs||0}ms`})))};n(i),u(l);const c=i.results.findIndex((e=>e.id===a));v(-1!==c?c:0)}catch(e){S("Failed to load test case details from API")}}}catch(s){S("Failed to load test case details")}finally{y(!1)}})()}),[t,a]);const E=e=>{if(!e)return"Unknown";try{return new Date(e.replace(" ","T")).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch(s){return e}},R=e=>{if(!d||!d.results||0===d.results.length)return;let s;s="next"===e?(f+1)%d.results.length:(f-1+d.results.length)%d.results.length;const a=d.results[s];window.history.pushState(null,"",`/test-execution/results/${t}/${a.id}`),window.location.reload()},k=e=>{try{if("string"==typeof e)try{const s=JSON.parse(e);return JSON.stringify(s,null,2)}catch{return e}return JSON.stringify(e,null,2)}catch(s){return String(e)}};if(N)return e.jsx("div",{className:"p-6 bg-gray-50 min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4 inline-block"}),e.jsx("p",{className:"text-gray-600",children:"Loading test case details..."})]})});if(w||!l||!d)return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsx(h,{items:[{label:"Test Execution"},{label:"Test Results",path:"/test-results"},{label:`Execution ${t}`,path:`/test-execution/results/${t}`},{label:"Test Case Details"}]}),e.jsx("div",{className:"flex items-center mb-6",children:e.jsxs("button",{onClick:r,className:"flex items-center text-indigo-600 hover:text-indigo-800 transition-colors",children:[e.jsx(i,{className:"mr-2"}),"Back to Execution Results"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-10 text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:w||"Test case not found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:w?"There was an error loading the test case details.":"The test case you're looking for doesn't exist or has been removed."}),e.jsx("button",{onClick:r,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Go Back to Execution Results"})]})]});const T=(()=>{if(!l?.assertions||0===l.assertions.length){return g(l).isExecutedWithoutAssertions?100:0}const e=l.assertions.filter((e=>"Passed"===e.status)).length;return Math.round(e/l.assertions.length*100)})();return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:r,className:"flex items-center text-indigo-600 hover:text-indigo-800 transition-colors",children:[e.jsx(i,{className:"mr-2"}),"Back to Execution Results"]}),d.results&&d.results.length>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>R("prev"),className:"p-2 rounded-md border border-gray-200 hover:bg-gray-50 text-gray-600",title:"Previous test case",children:e.jsx(i,{size:14})}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Test ",f+1," of ",d.results.length]}),e.jsx("button",{onClick:()=>R("next"),className:"p-2 rounded-md border border-gray-200 hover:bg-gray-50 text-gray-600",title:"Next test case",children:e.jsx(c,{size:14})})]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-1 text-gray-800",children:l.name}),e.jsxs("p",{className:"text-gray-600",children:["Execution ID: ",t]}),l.testSuiteName&&e.jsxs("p",{className:"text-gray-500 text-sm",children:["Suite: ",l.testSuiteName]})]}),(()=>{const s=g(l),t=j(s);return e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${t}`,children:s.displayText})})()]}),e.jsx("div",{className:"mb-6 bg-gray-100 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:`h-full ${(()=>{const e=g(l);return"Passed"===e.displayText?"bg-green-500":"Executed"===e.displayText?"bg-blue-500":"bg-red-500"})()} transition-all duration-500 ease-in-out`,style:{width:`${T}%`}})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"border rounded-lg shadow-sm p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:"Request"}),e.jsx("span",{className:"bg-indigo-100 text-indigo-700 text-xs px-2 py-1 rounded-full",children:l.request?.method||"GET"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"URL"}),e.jsx("div",{className:"bg-gray-50 p-2 rounded border border-gray-100 font-mono text-sm break-all",children:l.request?.url||"No URL provided"})]}),l.request?.headers&&Object.keys(l.request.headers).length>0&&e.jsx("div",{className:"mb-3",children:e.jsx(p,{title:"Headers",defaultOpen:!1,children:e.jsx("pre",{className:"bg-gray-50 p-3 rounded font-mono text-sm overflow-auto border border-gray-100 max-h-60",children:k(l.request.headers)})})}),l.request?.body&&e.jsx("div",{children:e.jsx(p,{title:"Request Body",defaultOpen:!1,children:e.jsx("pre",{className:"bg-gray-50 p-3 rounded font-mono text-sm overflow-auto border border-gray-100 max-h-60",children:k(l.request.body)})})})]}),e.jsxs("div",{className:"border rounded-lg shadow-sm p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:"Response"}),e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full "+(l.response?.status>=200&&l.response?.status<300?"bg-green-100 text-green-800":l.response?.status>=400?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:["Status: ",l.response?.status||"Unknown"]})]}),l.response?.data&&e.jsx("div",{children:e.jsx(p,{title:"Response Body",defaultOpen:!0,children:e.jsx("pre",{className:"bg-gray-50 p-3 rounded font-mono text-sm overflow-auto border border-gray-100 max-h-60",children:k(l.response.data)})})}),l.response?.headers&&Object.keys(l.response.headers).length>0&&e.jsx("div",{className:"mt-3",children:e.jsx(p,{title:"Response Headers",defaultOpen:!1,children:e.jsx("pre",{className:"bg-gray-50 p-3 rounded font-mono text-sm overflow-auto border border-gray-100 max-h-60",children:k(l.response.headers)})})})]})]}),e.jsxs("div",{className:"border rounded-lg shadow-sm overflow-hidden bg-white mb-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 border-b",children:e.jsxs("h2",{className:"font-semibold text-lg text-gray-800",children:["Assertions",l.assertionSummary&&e.jsxs("span",{className:"text-sm font-normal text-gray-600 ml-2",children:["(",l.assertionSummary.passed,"/",l.assertionSummary.total," passed)"]})]})}),e.jsx("div",{className:"p-4",children:l.assertionResults&&l.assertionResults.length>0?e.jsx(b,{assertions:l.assertionResults,summary:l.assertionSummary,compact:!1}):l.assertions&&l.assertions.length>0?e.jsx("div",{className:"space-y-3",children:l.assertions.map((s=>e.jsx("div",{className:"p-4 hover:bg-gray-50 border rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"mt-0.5 rounded-full p-1 mr-3 "+("Passed"===s.status?"bg-green-100 text-green-600":"bg-red-100 text-red-600"),children:"Passed"===s.status?e.jsx(o,{className:"h-4 w-4"}):e.jsx(x,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["Assertion #",s.id]}),e.jsx("div",{className:"text-gray-600 mt-1",children:s.description}),"Passed"!==s.status&&s.error&&e.jsx("div",{className:"mt-2 bg-red-50 text-red-700 p-2 rounded text-sm border border-red-100",children:s.error})]})]}),e.jsx("div",{children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("Passed"===s.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:s.status})})]})},s.id)))}):e.jsx("div",{className:"text-center text-gray-500 py-8",children:e.jsxs("div",{className:"bg-blue-50 rounded-lg p-6 border border-blue-200",children:[e.jsx("h3",{className:"text-lg font-medium text-blue-900 mb-2",children:"Test Executed Successfully"}),e.jsx("p",{className:"text-blue-700 mb-4",children:"This test case executed but had no assertions to validate the response."}),e.jsx("div",{className:"text-sm text-blue-800",children:"Consider adding assertions to validate response data, status codes, or performance metrics."})]})})})]}),e.jsxs("div",{className:"border rounded-lg shadow-sm overflow-hidden bg-white mb-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 border-b",children:e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:"Execution Details"})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Duration"}),e.jsx("div",{className:"font-medium",children:l.duration})]}),l.executedBy&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Executed By"}),e.jsx("div",{className:"font-medium",children:l.executedBy})]}),l.executionDate&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Execution Date"}),e.jsx("div",{className:"font-medium",children:E(l.executionDate)})]}),d.environment&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Environment"}),e.jsx("div",{className:"font-medium",children:d.environment})]})]})})]}),l.snippets&&e.jsxs("div",{className:"border rounded-lg shadow-sm overflow-hidden bg-white",children:[e.jsxs("div",{className:"bg-gray-50 p-4 border-b flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"})}),e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:"Code Snippets"})]}),e.jsx("div",{className:"p-4",children:e.jsx(p,{title:"Test Code",defaultOpen:!1,children:e.jsx("pre",{className:"bg-gray-50 p-3 rounded font-mono text-sm overflow-auto border border-gray-100",children:l.snippets.testCode||"// No test code available"})})})]})]})};export{N as default};
