import{j as e}from"./chunk-xjDKe2wf.js";import{R as s,a as t,u as a,r}from"./chunk-D8-U-K1F.js";import{B as l}from"./chunk-Dw3wbBjo.js";import{y as n}from"./chunk-CALic51h.js";import{g as i,r as d,s as o,t as c,v as m,w as u,x as p,e as x}from"../assets/index-OFcpw0jO.js";import{C as h}from"./chunk-CpSKtQtR.js";import"./chunk-SnPUoUoO.js";import"./chunk-SIvHljHK.js";const b=s.memo((({formData:s,apiOptions:t,loading:a,loadingApis:r,selectedApiId:l,selectedApiDetails:n,onFieldChange:i})=>e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Test case name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"testCaseName",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:s.testCaseName,onChange:i,disabled:a})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"type",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:s.type,onChange:i,disabled:a,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"functional",children:"functional"}),e.jsx("option",{value:"performance",children:"performance"}),e.jsx("option",{value:"security",children:"security"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Response type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"responseType",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:s.responseType,onChange:i,disabled:a,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"json",children:"json"}),e.jsx("option",{value:"xml",children:"xml"}),e.jsx("option",{value:"text",children:"text"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"API"}),e.jsxs("select",{name:"api",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:s.api,onChange:i,disabled:a||r,children:[e.jsx("option",{value:"",children:"Select"}),t.map((s=>e.jsxs("option",{value:s.name,children:[s.name," (",s.method," ",s.url,")"]},s.id)))]}),r&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Loading API details..."}),l&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["âœ“ API associated (ID: ",l,")"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["API Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"apiType",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:s.apiType,onChange:i,disabled:a||n,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"GET",children:"GET"}),e.jsx("option",{value:"POST",children:"POST"}),e.jsx("option",{value:"PUT",children:"PUT"}),e.jsx("option",{value:"DELETE",children:"DELETE"}),e.jsx("option",{value:"PATCH",children:"PATCH"})]}),n&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Using method from selected API"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["URL ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"url",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:s.url,onChange:i,placeholder:"/api/endpoint",disabled:a||n}),n&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Using URL from selected API"})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{name:"description",rows:"3",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:s.description,onChange:i,disabled:a})]})]})));b.displayName="FormFields";const g=({parameters:s})=>0===s.length?null:e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-900 mb-2",children:"Detected Parameters"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(((s,t)=>e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full border border-blue-300",children:["$","{"+s+"}"]},t)))}),e.jsx("p",{className:"text-xs text-blue-700 mt-2",children:"ðŸ’¡ These parameters will be available for variable configuration after saving"})]}),f=({requestTemplate:s,responseTemplate:t,uploadedRequestFileName:a,uploadedResponseFileName:r,onRequestTemplateChange:l,onResponseTemplateChange:i,onRequestFileNameChange:d,onResponseFileNameChange:o,onShowPreview:c,loading:m})=>{const u=({id:s,type:t,template:a,fileName:r,label:u})=>e.jsxs("div",{children:[e.jsxs("label",{className:"block font-medium mb-2 text-sm",children:[u," ",e.jsx("span",{className:"text-gray-500",children:"(Optional)"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("input",{id:s,type:"file",accept:".json",className:"hidden",onChange:e=>((e,s)=>{const t=e.target.files[0];if(t&&"application/json"===t.type){const e=new FileReader;e.onload=e=>{try{const a=JSON.parse(e.target.result),r=JSON.stringify(a,null,2);"request"===s?(d(t.name),l(r)):(o(t.name),i(r))}catch(a){n.error("Invalid JSON file. Please check the file format.")}},e.readAsText(t)}else n.error("Please upload a valid JSON file.")})(e,t),disabled:m}),e.jsx("label",{htmlFor:s,className:"cursor-pointer border px-4 py-2 text-sm rounded bg-white hover:bg-gray-100 transition-colors "+(m?"opacity-50 cursor-not-allowed":""),children:"Click to upload"}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-gray-700 flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),r]}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-[#4F46E5] text-white text-sm rounded hover:bg-[#4338CA] transition-colors",onClick:()=>c({type:t,content:a}),disabled:m,children:"Preview"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Note: Parameters in templates are not used for variable detection"})]});return e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[e.jsx(u,{id:"request-template",type:"request",template:s,fileName:a,label:"Request template"}),e.jsx(u,{id:"response-template",type:"response",template:t,fileName:r,label:"Response template"})]})},j=({title:s,content:t,onClose:a})=>t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full p-6 relative",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s}),e.jsx("pre",{className:"bg-gray-100 p-4 rounded overflow-auto max-h-96 text-sm whitespace-pre-wrap",children:t}),e.jsx("button",{className:"absolute top-3 right-3 text-gray-500 hover:text-gray-800 w-6 h-6 flex items-center justify-center",onClick:a,"aria-label":"Close modal",children:"âœ•"})]})}):null,y=e=>{if(!e)return[];const s=/\$\{([^}]+)\}/g,t=[];let a;for(;null!==(a=s.exec(e));)t.push(a[1]);return[...new Set(t)]},v=e=>{if(!e||"object"!=typeof e)return[];const s=[];return Object.entries(e).forEach((([e,t])=>{s.push(...y(e)),s.push(...y(String(t)))})),[...new Set(s)]},N=e=>{if(!e||"object"!=typeof e)return[];const s=[];return Object.entries(e).forEach((([e,t])=>{s.push(...y(e)),s.push(...y(String(t)))})),[...new Set(s)]},C=e=>{if(!e||"object"!=typeof e)return[];const s=[];return Object.entries(e).forEach((([e,t])=>{s.push(...y(e)),s.push(...y(String(t)))})),[...new Set(s)]},w=e=>{const s=[];if(e.url&&s.push(...y(e.url)),e.api&&e.api.request){const t=e.api.request;t.queryParams&&s.push(...v(t.queryParams)),t.headers&&s.push(...N(t.headers)),t.pathParams&&s.push(...C(t.pathParams))}return[...new Set(s)]},T=e=>{let s=[];if(e&&e.request){const t=e.request;t.queryParams&&s.push(...v(t.queryParams)),t.headers&&s.push(...N(t.headers)),t.pathParams&&s.push(...C(t.pathParams))}return[...new Set(s)]},S=({onParametersDetected:s,onTestCaseSaved:l})=>{const o=t(),c=a(),m=r.useMemo((()=>o.state?.testCase?.testCaseId),[o.state?.testCase?.testCaseId]),u=r.useMemo((()=>!!o.state?.testCase),[o.state?.testCase]),p=r.useRef(!1),x=r.useRef(null),[h,v]=r.useState(!1),[N,C]=r.useState(!1),[S,I]=r.useState([]),[P,k]=r.useState(null),[E,F]=r.useState(null),[A,q]=r.useState([]),[O,R]=r.useState({testCaseName:"",type:"",responseType:"",api:"",apiType:"",url:"",description:""}),[D,L]=r.useState(null),[$,M]=r.useState(""),[J,V]=r.useState(""),[U,G]=r.useState(""),[z,B]=r.useState(""),H=r.useCallback((()=>({userId:"302",transactionId:Date.now().toString(),timestamp:(new Date).toISOString()})),[]),Y=r.useCallback((e=>{s&&s(e)}),[s]),W=r.useCallback(((e,s)=>{l&&l(e,s)}),[l]);r.useEffect((()=>{(async()=>{C(!0);try{const e=await i("/api/v1/apirepos","GET");if(e?.result?.data){const s=e.result.data.content.map((e=>({id:e.apiId,name:e.apiRepoName,method:e.method,url:e.url})));I(s)}}catch(e){n.error("Failed to load APIs from repository"),I([{id:1,name:"LoginAPI",method:"POST",url:"/api/auth/login"},{id:2,name:"UserProfileAPI",method:"GET",url:"/api/users/${userId}"},{id:3,name:"ProductsAPI",method:"GET",url:"/api/products"},{id:4,name:"OrdersAPI",method:"POST",url:"/api/orders/${userId}"},{id:5,name:"PaymentAPI",method:"POST",url:"/api/payments"}])}finally{C(!1)}})()}),[]);const _=r.useCallback((()=>{const e=y(O.url),s=T(P),t=[...new Set([...e,...s])];q(t),t.length>0&&Y(t)}),[O.url,P,Y]),K=r.useCallback((async e=>{if(e)try{C(!0);const s=await i(`/api/v1/apirepos/${e}`,"GET");if(s?.result?.data){const t=s.result.data;k(t),F(e),R((e=>({...e,url:t.url,apiType:t.method}))),setTimeout(_,100)}else n.error("Invalid API data format")}catch(s){n.error("Failed to load API details")}finally{C(!1)}}),[_]);r.useEffect((()=>{if(!u||!m||p.current&&x.current===m)return;if(o.state?.testCase&&!o.state.testCase.testCaseId){const e=o.state.testCase;if(R({testCaseName:e.name||"",type:e.type||"",responseType:e.responseType||"",api:e.apiName||"",apiType:e.apiType||"",url:e.url||"",description:e.description||""}),e.apiId&&F(e.apiId),e.requestTemplate){const s="string"==typeof e.requestTemplate?e.requestTemplate:JSON.stringify(e.requestTemplate,null,2);G(s),M("existing-request.json")}if(e.responseTemplate){const s="string"==typeof e.responseTemplate?e.responseTemplate:JSON.stringify(e.responseTemplate,null,2);B(s),V("existing-response.json")}const s=w(e);q(s),Y(s),W(e.testCaseId,s)}else(async()=>{try{v(!0),p.current=!0,x.current=m;const e=await i(`/api/v1/test-cases/${m}`);if(e.result?.data){const s=e.result.data;if(R({testCaseName:s.name||"",type:s.type||"",responseType:s.responseType||"",api:s.apiName||"",apiType:s.apiType||"",url:s.url||"",description:s.description||""}),s.api&&s.api.apiId&&F(s.api.apiId),s.requestTemplate){const e="string"==typeof s.requestTemplate?s.requestTemplate:JSON.stringify(s.requestTemplate,null,2);G(e),M("existing-request.json")}if(s.responseTemplate){const e="string"==typeof s.responseTemplate?s.responseTemplate:JSON.stringify(s.responseTemplate,null,2);B(e),V("existing-response.json")}const t=w(s);q(t),Y(t),W(s.testCaseId,t),s.apiName&&s.api&&s.api.apiId&&await K(s.api.apiId)}}catch(e){n.error("Failed to load test case details"),p.current=!1,x.current=null}finally{v(!1)}})()}),[u,m,Y,W]),r.useEffect((()=>()=>{p.current=!1,x.current=null}),[m]);const Q=r.useCallback((e=>{const{name:s,value:t}=e.target;if(R((e=>({...e,[s]:t}))),"api"===s&&t){const e=S.find((e=>e.name===t));e?K(e.id):(k(null),F(null))}"url"===s&&setTimeout(_,100)}),[S,K,_]),X=r.useCallback((()=>{const e=[{field:"testCaseName",label:"Test case name"},{field:"type",label:"Type"},{field:"responseType",label:"Response type"},{field:"apiType",label:"API Type"},{field:"url",label:"URL"}].filter((({field:e})=>!O[e]));return!(e.length>0)||(n.error(`Please fill in the following required fields: ${e.map((e=>e.label)).join(", ")}`),!1)}),[O]),Z=r.useCallback((async()=>{if(X())try{v(!0);let s={},t={};if(U)try{s=JSON.parse(U)}catch(e){return void n.error("Invalid JSON in request template")}if(z)try{t=JSON.parse(z)}catch(e){return void n.error("Invalid JSON in response template")}const a={requestMetaData:H(),data:{name:O.testCaseName,type:O.type,responseType:O.responseType,apiName:O.api,apiType:O.apiType,url:O.url,description:O.description,executionOrder:1}};let r,l;U&&(a.data.requestTemplate=s),z&&(a.data.responseTemplate=t),E&&(a.data.apiId=E.toString()),u?(a.data.testCaseId=m,l=m,r=await i("/api/v1/test-cases","PUT",a),n.success("Test Case updated successfully!")):(r=await i("/api/v1/test-cases","POST",a),n.success("Test Case created successfully!"),l=r?.result?.data?.testCaseId);const d=y(O.url),o=T(P),c=[...new Set([...d,...o])];Y(c),W(l,c)}catch(e){n.error(e.message||"Failed to save test case")}finally{v(!1)}}),[X,U,z,H,O,E,u,m,P,Y,W]),ee=r.useCallback((()=>{c("/test-design/test-case")}),[c]);return e.jsxs("div",{className:"bg-white p-6 rounded border shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center",children:[e.jsx(d,{className:"mr-2 text-indigo-600"}),u?"Edit test case":"Create new test case"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[E&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm",children:["API ID: ",E]}),A.length>0&&e.jsxs("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm",children:[A.length," parameter",1!==A.length?"s":""," detected"]})]})]}),e.jsx(b,{formData:O,apiOptions:S,loading:h,loadingApis:N,selectedApiId:E,selectedApiDetails:P,onFieldChange:Q}),e.jsx(g,{parameters:A}),e.jsx(f,{requestTemplate:U,responseTemplate:z,uploadedRequestFileName:$,uploadedResponseFileName:J,onRequestTemplateChange:G,onResponseTemplateChange:B,onRequestFileNameChange:M,onResponseFileNameChange:V,onShowPreview:L,loading:h}),D&&e.jsx(j,{title:"request"===D.type?"Request Template":"Response Template",content:D.content,onClose:()=>L(null)}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx("button",{type:"button",onClick:ee,className:"px-4 py-2 border border-gray-300 rounded text-sm hover:bg-gray-50 transition-colors",disabled:h,children:"Cancel"}),e.jsx("button",{type:"button",onClick:Z,className:"px-4 py-2 bg-[#4F46E5] text-white rounded text-sm hover:bg-[#4338CA] transition-colors flex items-center "+(h?"opacity-50 cursor-not-allowed":""),disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"mr-2"}),u?"Update":"Save"]})})]})]})},I=({detectedParameters:s=[],testCaseId:a})=>{const l=t(),[d,b]=r.useState("Variables"),[g,f]=r.useState([]),[j,y]=r.useState(1),[v,N]=r.useState(!1),[C,w]=r.useState(!1),[T,S]=r.useState(!1),[I,P]=r.useState(!1),[k,E]=r.useState(!1),[F,A]=r.useState(!1),[q,O]=r.useState(null),[R,D]=r.useState(null),[L,$]=r.useState({name:"",value:""}),M=a||l.state?.testCase?.testCaseId,J=s?.length||0,V=g.filter((e=>s?.includes(e.name))).length,U=J-V,G=()=>({userId:localStorage.getItem("userId")||"302",transactionId:Date.now().toString(),timestamp:(new Date).toISOString()}),z=async()=>{if(M)try{N(!0);const e=await i(`/api/v1/variables/${M}`);if("200"===e.result?.code){const s=e.result.data||[];f(Array.isArray(s)?s:[])}else e.result,f([])}catch(e){e.message.includes("404")||e.message.toLowerCase().includes("not found")||n.error("Could not load existing variables, but you can still create new ones"),f([])}finally{N(!1),S(!0)}else S(!0)},B=async(e,s="")=>{try{const t={requestMetaData:G(),data:{name:e.trim(),value:s.trim(),source:"STATIC",testCase:{testCaseId:M}}},a=await i("/api/v1/variables","POST",t);if("200"===a.result?.code)return a.result.data;throw new Error(a.result?.message||"Failed to create variable")}catch(t){throw t}},H=()=>{$({name:"",value:""}),D(null),P(!0)},Y=()=>{P(!1),E(!1),$({name:"",value:""}),D(null)},W=(e,s)=>{$((t=>({...t,[e]:s})))},_=async()=>{const{name:e,value:s}=L;if(!e.trim())return void n.error("Variable name is required");if(g.find((s=>s.name.toLowerCase()===e.trim().toLowerCase()&&(!R||s.variableId!==R.variableId))))n.error("A variable with this name already exists");else try{N(!0),R?(await(async(e,s,t)=>{try{const a={requestMetaData:G(),data:{variableId:e,name:s.trim(),value:t.trim(),source:"STATIC",testCase:{testCaseId:M}}},r=await i("/api/v1/variables","PUT",a);if("200"===r.result?.code)return r.result.data;throw new Error(r.result?.message||"Failed to update variable")}catch(a){throw a}})(R.variableId,e,s),n.success("Variable updated successfully")):(await B(e,s),n.success("Variable created successfully")),await z(),Y()}catch(t){n.error(t.message||"Failed to save variable")}finally{N(!1)}};r.useEffect((()=>{M?z():S(!0)}),[M]);const K=Math.ceil(g.length/6),Q=g.slice(6*(j-1),6*j),X=({isOpen:t,isEdit:a=!1})=>t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[a?e.jsx(p,{className:"mr-2 text-indigo-600"}):e.jsx(u,{className:"mr-2 text-indigo-600"}),a?"Edit Variable":"Add New Variable"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:L.name,onChange:e=>W("name",e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"variable_name",autoFocus:!0}),s?.includes(L.name)&&e.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"ðŸ’¡ This matches a detected parameter"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Value"}),e.jsx("input",{type:"text",value:L.value,onChange:e=>W("value",e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"variable value"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{type:"button",onClick:Y,className:"px-4 py-2 border border-gray-300 rounded-md text-sm hover:bg-gray-50",disabled:v,children:"Cancel"}),e.jsxs("button",{type:"button",onClick:_,className:"px-4 py-2 bg-[#4F46E5] text-white text-sm rounded-md hover:bg-[#4338CA] flex items-center",disabled:v,children:[v&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),a?"Update":"Create"]})]})]})}):null;return T?e.jsxs("div",{className:"bg-white shadow p-6 rounded-lg mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("h2",{className:"text-md font-semibold flex items-center",children:[e.jsx(o,{className:"mr-2 text-gray-600"}),"Test case configuration"]}),J>0&&e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:[J," parameters detected"]}),U>0&&e.jsxs("span",{className:"bg-amber-100 text-amber-800 text-xs px-2 py-1 rounded-full",children:[U," not created"]}),0===U&&J>0&&e.jsxs("span",{className:"bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full flex items-center",children:[e.jsx(c,{className:"mr-1 h-3 w-3"}),"All parameters created"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[U>0&&e.jsx("button",{onClick:async()=>{if(s&&0!==s.length)if(0!==U){w(!0);try{const t=s.filter((e=>!g.some((s=>s.name===e))));let a=0,r=0;for(const s of t)try{await B(s,""),a++}catch(e){r++}a>0&&(n.success(`Created ${a} parameter variable${a>1?"s":""}`),await z()),r>0&&n.warning(`Failed to create ${r} parameter${r>1?"s":""}`)}catch(e){n.error("Error creating parameter variables")}finally{w(!1)}}else n.info("All detected parameters already have variables");else n.info("No parameters detected to create")},className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 flex items-center",disabled:!M||v||C,children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white mr-1"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"mr-1"}),"Create All Parameters (",U,")"]})}),e.jsxs("button",{onClick:H,className:"px-3 py-1 bg-[#4F46E5] text-white text-sm rounded hover:bg-[#4338CA] flex items-center",disabled:!M||v,children:[e.jsx(u,{className:"mr-1"}),"Add Variable"]})]})]}),J>0&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded-md border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900 mb-1",children:["Detected Parameters: ",s.join(", ")]}),e.jsxs("div",{className:"text-xs text-blue-700",children:[V," of ",J," parameters have been created as variables"]})]}),U>0&&e.jsx("div",{className:"text-xs text-blue-600",children:'ðŸ’¡ Use "Create All Parameters" to automatically create variables for all detected parameters'})]})}),0===J&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-md border border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx(o,{className:"inline mr-2"}),"No parameters detected in your test case templates. You can still create variables manually to store reusable values."]})}),e.jsx("div",{className:"flex mb-4 border-b",children:["Variables","Functions"].map((s=>e.jsxs("button",{className:"py-2 px-4 font-medium "+(d===s?"border-b-2 border-[#4F46E5] text-[#4F46E5]":"text-gray-500"),onClick:()=>b(s),children:[s,"Variables"===s&&g.length>0&&e.jsx("span",{className:"ml-1 bg-gray-200 text-gray-700 text-xs px-1.5 py-0.5 rounded-full",children:g.length})]},s)))}),e.jsx("div",{className:"border rounded overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 text-left text-xs uppercase text-gray-500 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 font-medium",children:"Name"}),e.jsx("th",{className:"p-3 font-medium",children:"Value"}),e.jsx("th",{className:"p-3 font-medium",children:"Type"}),e.jsx("th",{className:"p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:v&&0===g.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-4 text-center",children:e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-[#4F46E5] mr-2"}),"Loading variables..."]})})}):0===Q.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-8 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(o,{className:"h-8 w-8 text-gray-300 mb-3"}),e.jsx("div",{className:"text-lg font-medium mb-2",children:"No variables created yet"}),e.jsx("div",{className:"text-sm mb-4",children:M?"Create variables to store reusable values for your test case":"Save the test case first to start creating variables"}),M&&e.jsxs("button",{onClick:H,className:"px-4 py-2 bg-[#4F46E5] text-white text-sm rounded hover:bg-[#4338CA] flex items-center",children:[e.jsx(u,{className:"mr-1"}),"Create Your First Variable"]})]})})}):Q.map((t=>{const a=s?.includes(t.name),r=t.value&&""!==t.value.trim();return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium",children:t.name}),a&&e.jsx("span",{className:"ml-2 bg-blue-100 text-blue-700 text-xs px-1.5 py-0.5 rounded-full",children:"Parameter"})]})}),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"truncate max-w-xs",children:r?e.jsx("span",{className:"text-gray-900",children:t.value}):e.jsx("span",{className:"text-gray-400 italic",children:"Empty"})})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"text-xs px-2 py-1 rounded-full "+(a?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:a?"Auto-detected":"Manual"})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>(e=>{$({name:e.name||"",value:e.value||""}),D(e),E(!0)})(t),className:"text-gray-400 hover:text-[#4F46E5] transition-colors",title:"Edit variable",disabled:v,children:e.jsx(p,{size:16})}),e.jsx("button",{onClick:()=>(e=>{O(e),A(!0)})(t),className:"text-gray-400 hover:text-red-500 transition-colors",title:"Delete variable",disabled:v,children:e.jsx(x,{size:16})})]})})]},t.variableId)}))})]})}),(()=>{if(K<=1)return null;const s=[],t=Math.floor(2.5);let a=Math.max(1,j-t),r=Math.min(K,a+5-1);r-a<4&&(a=Math.max(1,r-5+1));for(let e=a;e<=r;e++)s.push(e);return e.jsxs("div",{className:"flex justify-end mt-4 space-x-1 text-sm",children:[e.jsx("button",{className:"px-3 py-1 border rounded hover:bg-gray-100 disabled:opacity-40",disabled:1===j,onClick:()=>y(j-1),children:"Prev"}),a>1&&e.jsx("span",{className:"px-2",children:"..."}),s.map((s=>e.jsx("button",{onClick:()=>y(s),className:"px-3 py-1 rounded "+(s===j?"bg-[#4F46E5] text-white":"border hover:bg-gray-100"),children:s},s))),r<K&&e.jsx("span",{className:"px-2",children:"..."}),e.jsx("button",{className:"px-3 py-1 border rounded hover:bg-gray-100 disabled:opacity-40",disabled:j===K,onClick:()=>y(j+1),children:"Next"})]})})(),"Functions"===d&&e.jsxs("div",{className:"mt-4 p-8 text-center text-gray-500 bg-gray-50 rounded-md",children:[e.jsx(o,{className:"h-8 w-8 text-gray-300 mb-3 mx-auto"}),e.jsx("div",{className:"text-lg font-medium mb-2",children:"Functions Coming Soon"}),e.jsx("div",{className:"text-sm",children:"Function management will be available in a future update."})]}),e.jsx(X,{isOpen:I,isEdit:!1}),e.jsx(X,{isOpen:k,isEdit:!0}),e.jsx(h,{isOpen:F,onClose:()=>{A(!1),O(null)},onConfirm:async()=>{if(q)try{N(!0),await(async e=>{try{const s=await i(`/api/v1/variables/${e}`,"DELETE");if("200"===s.result?.code)return!0;throw new Error(s.result?.message||"Failed to delete variable")}catch(s){throw s}})(q.variableId),n.success("Variable deleted successfully"),await z()}catch(e){n.error(e.message||"Failed to delete variable")}finally{N(!1),A(!1),O(null)}},title:"Delete Variable",message:`Are you sure you want to delete "${q?.name}"? This action cannot be undone.`})]}):e.jsx("div",{className:"bg-white shadow p-6 rounded-lg mt-8",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mr-3"}),e.jsx("span",{className:"text-gray-600",children:"Loading configuration..."})]})})},P=()=>{const n=t();a();const[i,d]=r.useState([]),[o,c]=r.useState(!1),[m,u]=r.useState(null),[p,x]=r.useState(!1),h=r.useMemo((()=>n.state?.testCase),[n.state?.testCase]),b=r.useMemo((()=>!!h),[h]),g=r.useMemo((()=>h?.testCaseId),[h?.testCaseId]),f=r.useCallback((e=>{d(e||[]),x(!0)}),[]),j=r.useCallback(((e,s=[])=>{u(e),c(!0),d(s||[]),x(!0)}),[]),y=r.useCallback((e=>{if(!e)return[];const s=/\$\{([^}]+)\}/g,t=[];let a;for(;null!==(a=s.exec(e));)t.push(a[1]);return t}),[]);return s.useEffect((()=>{if(b&&g){u(g),c(!0),x(!0);const e=[];if(h.url){const s=y(h.url);e.push(...s)}if(h.requestTemplate){const s=y(JSON.stringify(h.requestTemplate));e.push(...s)}if(h.responseTemplate){const s=y(JSON.stringify(h.responseTemplate));e.push(...s)}const s=[...new Set(e)];d(s)}}),[b,g,h,y]),e.jsxs("div",{className:"p-6",children:[e.jsx(l,{items:[{label:"Test Design"},{label:"Test Case",path:"/test-design/test-case"},{label:b?"Edit":"Create"}]}),e.jsx(S,{onParametersDetected:f,onTestCaseSaved:j}),(p||o||b)&&e.jsx(I,{detectedParameters:i,testCaseId:m||g},`config-${m||g}`)]})};export{P as default};
