import{j as e}from"./chunk-BonG-WPQ.js";import{r as t,u as s,a}from"./chunk-C74fWxxE.js";import{y as r}from"./chunk-Dw5YO7VD.js";import{e as i,g as n}from"../assets/index-BIbMNroQ.js";import{I as c}from"./chunk-Z8Kcj2P_.js";import{B as l}from"./chunk-CdK_kaRc.js";import{C as o}from"./chunk-BlCQ1V_y.js";import{B as d}from"./chunk-Bq23yqQC.js";import{n as m}from"./chunk-BV3C3NLD.js";import"./chunk-SnPUoUoO.js";import"./chunk-4QNEI4IN.js";const x=({testSuites:s,onAddToPackage:a,packageId:d,packageCreated:m,prefilledSuites:x=[]})=>{const[p,u]=t.useState([]),[h,g]=t.useState([]),[b,y]=t.useState([]),[j,f]=t.useState(1),[N,k]=t.useState(!1),[v,S]=t.useState(null),[w,T]=t.useState(!1),[C,D]=t.useState(null),[I,E]=t.useState(!1);t.useEffect((()=>{if(m)(async()=>{try{const e=await n("/api/v1/test-suites?pageNo=0&limit=50&sortBy=createdDate&sortDir=DESC","GET"),{code:t,data:s}=e.result;if("200"===t){const e=s.content.map((e=>({id:e.testSuiteID,name:e.suiteName,description:e.description})));g(e)}else r.error("Failed to load test suites")}catch(e){r.error("Error fetching test suites")}})(),(async()=>{try{const e=await n(`/api/v1/packages/${d}/test-suites`,"GET"),{code:t,data:s}=e.result;if("200"===t&&Array.isArray(s)){const e=s.map((e=>({id:e.testSuiteID,name:e.suiteName,description:e.description})));y(e),g((t=>t.filter((t=>!e.some((e=>e.id===t.id))))))}}catch(e){r.error("Error loading previously assigned test suites")}})();else if(x.length>0){const e=x.map(((e,t)=>({id:Date.now()+t,name:e,description:`This is the description for ${e}`})));y(e)}}),[m,d,x]);const P=b.slice(6*(j-1),6*j),F=Math.ceil(b.length/6);return e.jsxs("div",{className:"bg-white shadow p-6 rounded-lg mt-8",children:[e.jsxs("h3",{className:"font-semibold text-sm text-gray-700 mb-2",children:["Test package configuration",e.jsx("span",{className:"ml-2 text-blue-500 text-xs bg-blue-100 px-2 py-1 rounded-full",children:"ℹ Assign Suite"})]}),e.jsxs("div",{className:"relative w-full col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-1 block",children:"Select Test Suite"}),e.jsxs("div",{onClick:()=>k(!N),className:"flex items-center flex-wrap min-h-[46px] w-full px-3 py-2 border border-gray-300 rounded bg-white cursor-pointer hover:border-indigo-500 transition-all",children:[0===p.length&&e.jsx("span",{className:"text-sm text-gray-400",children:"Select test suite(s)"}),p.map((t=>e.jsxs("span",{className:"flex items-center bg-indigo-100 text-indigo-700 px-3 py-1 text-xs rounded-full mr-2 mb-1",onClick:e=>e.stopPropagation(),children:[t.name,e.jsx("button",{onClick:e=>{e.stopPropagation(),(e=>{const t=p.find((t=>t.id===e));t&&g((e=>[...e,t])),u((t=>t.filter((t=>t.id!==e))))})(t.id)},className:"ml-2 text-xs font-bold text-indigo-500 hover:text-red-500",children:"×"})]},t.id))),p.length>0&&e.jsx("button",{onClick:e=>{e.stopPropagation(),(()=>{if(0===p.length)return void r.warning("No test Suites selected");const e=[...b,...p];y(e),u([]),r.success("Test Suites added to package")})()},className:"ml-auto bg-[#4F46E5] text-white text-xs px-3 py-1 rounded hover:bg-[#4338CA] whitespace-nowrap",children:"Add to package"})]}),N&&e.jsx("div",{className:"absolute z-10 w-full max-h-60 overflow-y-auto mt-1 bg-white border border-gray-300 rounded shadow-md",children:h.length>0?h.filter((e=>!p.find((t=>t.id===e.id))&&!b.find((t=>t.id===e.id)))).map((t=>e.jsxs("div",{onClick:()=>(e=>{u((t=>[...t,e])),g((t=>t.filter((t=>t.id!==e.id)))),k(!1)})(t),className:"px-4 py-2 hover:bg-indigo-50 hover:text-indigo-700 cursor-pointer text-sm text-gray-700 transition-all",children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsx("div",{className:"text-xs text-gray-400",children:t.description})]},t.id))):e.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No available suites"})})]}),b.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"w-full border mt-4",children:[e.jsx("thead",{className:"bg-gray-50 border-b text-left",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Suite ID"}),e.jsx("th",{className:"p-3",children:"Test Suite Name"}),e.jsx("th",{className:"p-3",children:"Description"}),e.jsx("th",{className:"p-3 text-center",children:"Action"})]})}),e.jsx("tbody",{children:P.map((t=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-3",children:t.id}),e.jsx("td",{className:"p-3",children:t.name}),e.jsx("td",{className:"p-3",children:t.description}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("button",{onClick:()=>(e=>{const t=b.find((t=>t.id===e));t&&(D(t),T(!0))})(t.id),disabled:I,children:e.jsx(c,{icon:i})})})]},t.id)))})]}),(()=>{let t=[];const s=Math.max(1,j-2),a=Math.min(F,j+2);for(let r=s;r<=a;r++)t.push(e.jsx("button",{className:"px-2 py-1 mx-1 "+(r===j?"bg-indigo-600 text-white":"bg-white border hover:bg-gray-100"),onClick:()=>f(r),children:r},r));return e.jsxs("div",{className:"flex justify-end items-center px-4 py-3 text-sm text-gray-600 gap-1",children:[e.jsx("button",{disabled:1===j,onClick:()=>f(j-1),className:"px-3 py-1 border rounded hover:bg-gray-100 disabled:opacity-40",children:"Prev"}),s>1&&e.jsx("span",{children:"..."}),t,a<F&&e.jsx("span",{children:"..."}),e.jsx("button",{disabled:j===F,onClick:()=>f(j+1),className:"px-3 py-1 border rounded hover:bg-gray-100 disabled:opacity-40",children:"Next"})]})})(),e.jsxs("div",{className:"flex justify-end mt-4 space-x-3",children:[e.jsx("button",{onClick:()=>{const e=[...h,...b];g(e),y([]),u([])},className:"px-4 py-2 border rounded text-sm text-gray-700 bg-white hover:bg-gray-100",children:"Cancel"}),e.jsx(l,{onClick:async()=>{try{const e={requestMetaData:{userId:localStorage.getItem("userId")||"001",transactionId:Date.now().toString(),timestamp:(new Date).toISOString()},data:b.map((e=>e.id))},t=await n(`/api/v1/test-suites/associate-to-packages/${d}`,"POST",e),{code:s,message:a}=t.result;"200"===s?r.success(a||"Test Suites associated successfully"):r.error(a||"Failed to associate test suites")}catch(e){r.error("Error associating test suites")}},children:"Create"})]})]}),e.jsx(o,{isOpen:w,onClose:()=>{T(!1),D(null)},onConfirm:async()=>{if(C&&d){E(!0);try{const e={requestMetaData:{userId:localStorage.getItem("userId")||"302",transactionId:Date.now().toString(),timestamp:(new Date).toISOString()},data:{testPackageId:parseInt(d),testSuiteId:C.id}},t=await n("/api/v1/test-suites/remove-assoc-to-packages","DELETE",e);if("200"!==t.result?.code)throw new Error(t.result?.message||"Failed to remove test suite");r.success(t.result.message||"Test suite removed from package successfully"),y(b.filter((e=>e.id!==C.id))),g((e=>[...e,C]))}catch(e){r.error(e.message||"Failed to remove test suite from package")}finally{E(!1),T(!1),D(null)}}else r.error("Missing required information")},title:"Remove Test Suite",message:`Are you sure you want to remove "${C?.name}" from this package? This action cannot be undone.`})]})},p=({onSave:s,onCancel:a,isUpdate:r=!1,defaultValues:i})=>{const[n,c]=t.useState({name:"",execution:"On demand",executionType:"Execute all test case if any fails",reportType:"PDF",description:""});t.useEffect((()=>{i&&c({...n,...i})}),[i]);const o=e=>{const{name:t,value:s}=e.target;c((e=>({...e,[t]:s})))};return e.jsxs("div",{className:"bg-white p-6 rounded border shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-800",children:r?`Edit ${i?.name||"Test Package"}`:"Create new Test Package"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Package name"}),e.jsx("input",{type:"text",name:"name",value:n.name,onChange:o,className:"w-full border rounded px-3 py-2 text-sm",placeholder:"Login_Test_Package"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Execution"}),e.jsxs("select",{name:"execution",value:n.execution,onChange:o,className:"w-full border rounded px-3 py-2 text-sm",children:[e.jsx("option",{children:"On demand"}),e.jsx("option",{children:"Scheduled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Execution type"}),e.jsxs("select",{name:"executionType",value:n.executionType,onChange:o,className:"w-full border rounded px-3 py-2 text-sm",children:[e.jsx("option",{children:"Execute all test case if any fails"}),e.jsx("option",{children:"Stop on first failure"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Report type"}),e.jsxs("select",{name:"reportType",value:n.reportType,onChange:o,className:"w-full border rounded px-3 py-2 text-sm",children:[e.jsx("option",{children:"PDF"}),e.jsx("option",{children:"HTML"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{name:"description",rows:"3",value:n.description,onChange:o,className:"w-full border rounded px-3 py-2 text-sm",placeholder:"Tests login functionality, including valid/invalid credentials"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{c({name:"",execution:"On demand",executionType:"Execute all test case if any fails",reportType:"PDF",description:""}),a?.()},className:"px-4 py-2 border rounded text-sm text-gray-700 bg-white hover:bg-gray-100",children:"Cancel"}),e.jsx(l,{onClick:e=>{e.preventDefault(),s?.(n)},children:r?"Update":"Save"})]})]})},u=()=>{s();const{state:i}=a(),c=!!i?.package,[l,o]=t.useState((()=>i?.package?.id||null)),[u,h]=t.useState(c),[g,b]=t.useState([]),[y,j]=t.useState(!1),[f,N]=t.useState(null);t.useEffect((()=>{if(!l)return;i?.package?.id&&!l&&o(i.package.id);(async()=>{j(!0);try{const e=await n(`/api/v1/packages/${l}`,"GET"),{code:t,message:s,data:a}=e.result;"200"===t?N({name:a.packageName,description:a.description,execution:a.execution,executionType:a.executionType,reportType:a.reportType}):r.error(s||"Failed to load package data")}catch(e){r.error("Error while loading test package")}finally{j(!1)}})()}),[i,l]);return e.jsxs("div",{className:"p-6 font-inter",children:[e.jsx(d,{items:[{label:"Test Design"},{label:"Test Package",path:"/test-design/test-package"},{label:c?"Update":"Create"}]}),e.jsx("hr",{className:"mb-6 border-gray-200"}),e.jsx(p,{onSave:async e=>{const t=!!l,s={requestMetaData:{userId:localStorage.getItem("userId")||"00",transactionId:m(),timestamp:(new Date).toISOString()},data:{packageName:e.name,description:e.description,execution:e.execution,executionType:e.executionType,reportType:e.reportType,...t&&{testPackageID:l}}};try{const a=await n("/api/v1/packages",t?"PUT":"POST",s),{code:i,message:c,data:l}=a.result;"200"===i?(r.success(`"${e.name}" ${t?"Updated":"Created"} successfully`),!t&&l?.testPackageID&&o(l.testPackageID),h(!0)):r.error(c||"Failed to create test package")}catch(a){r.error("Error occurred during creation")}},onCancel:()=>h(!1),isUpdate:!!l,defaultValues:f}),e.jsx("hr",{className:"my-6 border-gray-200"}),e.jsx(x,{packageCreated:u,packageId:l,prefilledSuites:i?.package?.testSuites||[]}),g.length>0&&e.jsxs("div",{className:"mt-8 bg-white p-4 border shadow-sm rounded",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-4",children:"Associated Test Cases"}),e.jsxs("table",{className:"min-w-full text-sm border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-gray-700 text-left",children:[e.jsx("th",{className:"px-4 py-2 border",children:"Test Case Name"}),e.jsx("th",{className:"px-4 py-2 border",children:"Status"}),e.jsx("th",{className:"px-4 py-2 border",children:"Created Date"}),e.jsx("th",{className:"px-4 py-2 border",children:"Executed Date"})]})}),e.jsx("tbody",{children:g.map((t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2 border",children:t.name}),e.jsx("td",{className:"px-4 py-2 border",children:t.status}),e.jsx("td",{className:"px-4 py-2 border",children:t.createdDate}),e.jsx("td",{className:"px-4 py-2 border",children:t.executedDate})]},t.id)))})]})]})]})};export{u as default};
