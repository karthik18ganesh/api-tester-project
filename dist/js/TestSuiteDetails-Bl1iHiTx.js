import{j as e}from"./chunk-D8bRv3Ag.js";import{r as t,a as s,u as a}from"./chunk-C74fWxxE.js";import{y as i}from"./chunk-Dw5YO7VD.js";import{n as r}from"./chunk-BV3C3NLD.js";import{e as n,g as l}from"../assets/index-DUtqALCq.js";import{I as c}from"./chunk-CqWv0TDr.js";import{B as o}from"./chunk-DTxknuJ7.js";import{C as d}from"./chunk-3k1Tcz0K.js";import{B as u}from"./chunk-Daju2wTE.js";import"./chunk-SnPUoUoO.js";import"./chunk-4QNEI4IN.js";const m=({suiteId:s,onComplete:a})=>{const[u,m]=t.useState([]),[x,h]=t.useState([]),[p,f]=t.useState([]),[g,b]=t.useState(1),[j,y]=t.useState(!1),[v,N]=t.useState(!1),[w,S]=t.useState(!1),[C,D]=t.useState(null),[T,k]=t.useState(!1),[I,E]=t.useState(!1),M=t.useRef(!1),P=t.useRef(!1),F=t.useRef(!1);t.useEffect((()=>{(async()=>{if(!M.current&&!F.current){F.current=!0,y(!0);try{const t=await l("/api/v1/test-cases?pageNo=0&limit=100&sortBy=createdDate&sortDir=DESC","GET"),{code:a,message:r,data:n}=t.result;if("200"===a){const t=n.content.map((e=>({id:e.testCaseId,name:e.name,description:e.description||`Description for ${e.name}`,createdDate:new Date(e.createdDate).toLocaleDateString(),executedDate:e.executedDate?new Date(e.executedDate).toLocaleDateString():"-",status:e.status||"Pending"})));if(s)try{const e=await l(`/api/v1/test-suites/${s}/test-cases`,"GET"),{code:a,data:i}=e.result;if("200"===a&&Array.isArray(i)){const e=i.map((e=>({id:e.testCaseId,name:e.name,description:e.description||`Description for ${e.name}`,createdDate:new Date(e.createdDate).toLocaleDateString(),executedDate:e.executedDate?new Date(e.executedDate).toLocaleDateString():"-",status:e.status||"Pending"})));f(e);const s=e.map((e=>e.id)),a=t.filter((e=>!s.includes(e.id)));h(a)}else h(t)}catch(e){h(t)}else h(t);M.current=!0,P.current=!0}else i.error(r||"Failed to fetch test cases")}catch(t){i.error("Error loading test cases")}finally{y(!1),F.current=!1}}})()}),[s]),t.useEffect((()=>{null!=s&&s!==A.current&&(M.current=!1,P.current=!1,A.current=s)}),[s]);const A=t.useRef(null),O=p.slice(6*(g-1),6*g),L=Math.ceil(p.length/6);return j&&!M.current?e.jsx("div",{className:"bg-white shadow p-6 rounded-lg mt-8 flex justify-center",children:e.jsx("div",{className:"text-gray-600",children:"Loading test cases..."})}):e.jsxs("div",{className:"bg-white shadow p-6 rounded-lg mt-8",children:[e.jsxs("h3",{className:"font-semibold text-sm text-gray-700 mb-2",children:["Test suite configuration",e.jsx("span",{className:"ml-2 text-blue-500 text-xs bg-blue-100 px-2 py-1 rounded-full",children:"â„¹ Assign test cases"})]}),e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-1 block",children:"Select test case"}),e.jsxs("div",{className:"flex items-center mb-4 space-x-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 flex-1 border px-2 py-2 rounded",children:[u.map((t=>e.jsxs("span",{className:"bg-blue-100 text-blue-600 px-2 py-1 text-sm rounded-full flex items-center space-x-1",children:[e.jsx("span",{children:t.name}),e.jsx("button",{onClick:()=>(e=>{const t=u.find((t=>t.id===e));h([...x,t]),m(u.filter((t=>t.id!==e)))})(t.id),className:"text-xs font-bold px-1",children:"Ã—"})]},t.id))),e.jsxs("select",{onChange:e=>{const t=e.target.value;if(!t)return;const s=x.find((e=>e.id===parseInt(t)));s&&(m([...u,s]),h(x.filter((e=>e.id!==s.id))))},className:"outline-none flex-1 bg-transparent",value:"",disabled:v,children:[e.jsx("option",{value:"",children:"Select a test case"}),x.map((t=>e.jsx("option",{value:t.id,children:t.name},t.id)))]})]}),e.jsx("button",{className:"px-4 py-2 bg-[#4F46E5] text-white text-sm rounded hover:bg-[#4338CA] disabled:opacity-50",onClick:async()=>{if(0!==u.length)if(s){N(!0);try{const e=u.map((e=>e.id)),t={requestMetaData:{userId:localStorage.getItem("userId")||"302",transactionId:r(),timestamp:(new Date).toISOString()},data:e},a=await l(`/api/v1/test-cases/associate-to-suite/${s}`,"POST",t),{code:n,message:c}=a.result;"200"===n?(i.success("Test cases successfully associated with suite"),f([...p,...u]),m([])):i.error(c||"Failed to associate test cases")}catch(e){i.error("Error associating test cases with suite")}finally{N(!1)}}else f([...p,...u]),m([]),i.success("Test cases added to suite");else i.warning("No test cases selected")},disabled:0===u.length||v,children:v?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 inline text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Adding..."]}):"Add to suite"})]}),e.jsx("div",{className:"mt-6 mb-2",children:e.jsx("h4",{className:"font-semibold text-sm text-gray-700",children:"Associated Test Cases"})}),p.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"w-full border mt-2",children:[e.jsx("thead",{className:"bg-gray-50 border-b text-left",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Case ID"}),e.jsx("th",{className:"p-3",children:"Test Case Name"}),e.jsx("th",{className:"p-3",children:"Description"}),e.jsx("th",{className:"p-3 text-center",children:"Action"})]})}),e.jsx("tbody",{children:O.map((t=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-3",children:t.id}),e.jsx("td",{className:"p-3",children:t.name}),e.jsx("td",{className:"p-3",children:t.description}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("button",{onClick:()=>(e=>{const t=p.find((t=>t.id===e));t&&(D(t),S(!0))})(t.id),disabled:T,children:e.jsx(c,{icon:n})})})]},t.id)))})]}),L>1&&(()=>{let t=[];const s=Math.max(1,g-2),a=Math.min(L,g+2);for(let i=s;i<=a;i++)t.push(e.jsx("button",{className:"px-2 py-1 mx-1 "+(i===g?"bg-indigo-600 text-white":"bg-white border hover:bg-gray-100"),onClick:()=>b(i),children:i},i));return e.jsxs("div",{className:"flex justify-end items-center px-4 py-3 text-sm text-gray-600 gap-1",children:[e.jsx("button",{disabled:1===g,onClick:()=>b(Math.max(1,g-1)),className:"px-3 py-1 border rounded hover:bg-gray-100 disabled:opacity-40",children:"Prev"}),s>1&&e.jsx("span",{children:"..."}),t,a<L&&e.jsx("span",{children:"..."}),e.jsx("button",{disabled:g===L,onClick:()=>b(Math.min(L,g+1)),className:"px-3 py-1 border rounded hover:bg-gray-100 disabled:opacity-40",children:"Next"})]})})()]}):e.jsx("div",{className:"p-4 border border-dashed rounded-md text-center text-gray-500",children:"No test cases associated with this suite yet. Select test cases from the dropdown above."}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(o,{onClick:async()=>{if(s&&p.length>0){E(!0);try{const e=p.map((e=>e.id)),t={requestMetaData:{userId:localStorage.getItem("userId")||"302",transactionId:r(),timestamp:(new Date).toISOString()},data:e},n=await l(`/api/v1/test-cases/associate-to-suite/${s}`,"POST",t),{code:c,message:o}=n.result;"200"===c?(i.success("Test suite configuration saved successfully"),a&&a()):i.error(o||"Failed to save test suite configuration")}catch(e){i.error("Error saving test suite configuration")}finally{E(!1)}}else a&&a()},disabled:I,children:I?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 inline text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save"})}),e.jsx(d,{isOpen:w,onClose:()=>{S(!1),D(null)},onConfirm:async()=>{if(C&&s){k(!0);try{const e={requestMetaData:{userId:localStorage.getItem("userId")||"302",transactionId:r(),timestamp:(new Date).toISOString()},data:{testCaseId:C.id,testSuiteId:parseInt(s)}},t=await l("/api/v1/test-cases/remove-assoc-to-suite","DELETE",e);if("200"!==t.result?.code)throw new Error(t.result?.message||"Failed to remove test case");i.success(t.result.message||"Test case removed from suite successfully"),f((e=>e.filter((e=>e.id!==C.id)))),h((e=>[...e,C]))}catch(e){i.error(e.message||"Failed to remove test case from suite")}finally{k(!1),S(!1),D(null)}}else i.error("Missing required information")},title:"Remove Test Case",message:`Are you sure you want to remove "${C?.name}" from this suite? This action cannot be undone.`})]})},x=({onSave:s,onCancel:a,isUpdate:i=!1,defaultValues:r,isSaving:n=!1})=>{const[l,c]=t.useState({name:"",description:"",execution:"On demand",executionType:"Execute all test case if any fails",reportType:"PDF",publishMethod:"",email:"",ftpPath:""});t.useEffect((()=>{r&&c((e=>({...e,...r})))}),[r]);const d=e=>{const{name:t,value:s}=e.target;c((e=>({...e,[t]:s})))};return e.jsxs("div",{className:"bg-white p-6 rounded border shadow-sm",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-gray-800",children:i?`Update test suite: ${r?.name||""}`:"Create new test suite"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Suite name"}),e.jsx("input",{type:"text",name:"name",value:l.name,onChange:d,className:"w-full border rounded px-3 py-2 text-sm",placeholder:"Login_Test_Suite",disabled:n})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Execution"}),e.jsxs("select",{name:"execution",value:l.execution,onChange:d,className:"w-full border rounded px-3 py-2 text-sm",disabled:n,children:[e.jsx("option",{children:"On demand"}),e.jsx("option",{children:"Scheduled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Execution type"}),e.jsxs("select",{name:"executionType",value:l.executionType,onChange:d,className:"w-full border rounded px-3 py-2 text-sm",disabled:n,children:[e.jsx("option",{children:"Execute all test case if any fails"}),e.jsx("option",{children:"Stop on first failure"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Report type"}),e.jsxs("select",{name:"reportType",value:l.reportType,onChange:d,className:"w-full border rounded px-3 py-2 text-sm",disabled:n,children:[e.jsx("option",{children:"PDF"}),e.jsx("option",{children:"HTML"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Publish method"}),e.jsxs("select",{name:"publishMethod",value:l.publishMethod,onChange:d,className:"w-full border rounded px-3 py-2 text-sm",disabled:n,children:[e.jsx("option",{value:"",children:"Select Publish Method"}),e.jsx("option",{children:"Email"}),e.jsx("option",{children:"FTP path"}),e.jsx("option",{children:"In-app"})]})]}),"Email"===l.publishMethod&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",name:"email",value:l.email,onChange:d,placeholder:"tester@example.com",className:"w-full border rounded px-3 py-2 text-sm",disabled:n})]}),"FTP path"===l.publishMethod&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"FTP path"}),e.jsx("input",{type:"text",name:"ftpPath",value:l.ftpPath,onChange:d,placeholder:"/ftp/test_suites/login/",className:"w-full border rounded px-3 py-2 text-sm",disabled:n})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{name:"description",rows:"3",value:l.description,onChange:d,className:"w-full border rounded px-3 py-2 text-sm",placeholder:"Tests login functionality, including valid/invalid credentials",disabled:n})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{c({name:"",execution:"On demand",executionType:"Execute all test case if any fails",reportType:"PDF",publishMethod:"",email:"",ftpPath:"",description:""}),a?.()},className:"px-4 py-2 border rounded text-sm text-gray-700 bg-white hover:bg-gray-100 hover:-translate-y-0.5 transition-all",disabled:n,children:"Cancel"}),e.jsx(o,{onClick:e=>{e.preventDefault(),s?.(l)},disabled:n,className:"hover:-translate-y-0.5 transition-all",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white inline",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),i?"Updating...":"Saving..."]}):i?"Update":"Save"})]})]})},h=()=>{const{state:n}=s(),c=!!n?.suite,[o,d]=t.useState(!1),[h,p]=t.useState(null),[f,g]=t.useState(!1),[b,j]=t.useState(!1),[y,v]=t.useState(null),N=t.useRef(!1),w=t.useRef(!1),S=a(),C=n?.suite?.id;return t.useEffect((()=>{(async()=>{if(C&&!N.current&&!w.current){w.current=!0,g(!0);try{const e=await l(`/api/v1/test-suites/${C}`,"GET"),{code:t,message:s,data:a}=e.result;"200"===t?(p({name:a.suiteName,description:a.description,execution:a.execution||"On demand",executionType:a.executionType||"Execute all test case if any fails",reportType:a.reportType||"PDF",publishMethod:a.publishMethod||"",email:a.email||"",ftpPath:a.ftpPath||""}),N.current=!0,d(!0)):i.error(s||"Failed to load suite data")}catch(e){i.error("Error fetching test suite data")}finally{g(!1),w.current=!1}}})()}),[C]),f&&!N.current?e.jsx("div",{className:"p-6 font-inter flex justify-center items-center min-h-[400px]",children:e.jsx("div",{className:"text-lg text-gray-600",children:"Loading test suite details..."})}):e.jsxs("div",{className:"p-6 font-inter",children:[e.jsx(u,{items:[{label:"Test Design"},{label:"Test Suite",path:"/test-design/test-suite"},{label:c?"Update":"Create"}]}),e.jsx("hr",{className:"mb-6 border-gray-200"}),e.jsx(x,{onSave:async e=>{const t=!!C;j(!0);const s={requestMetaData:{userId:localStorage.getItem("userId")||"302",transactionId:r(),timestamp:(new Date).toISOString()},data:{suiteName:e.name,description:e.description,execution:e.execution,executionType:e.executionType,reportType:e.reportType,publishMethod:e.publishMethod,..."Email"===e.publishMethod?{email:e.email}:{},..."FTP path"===e.publishMethod?{ftpPath:e.ftpPath}:{},...t&&{testSuiteID:C}}};try{const e=await l("/api/v1/test-suites",t?"PUT":"POST",s),{code:a,message:r,data:n}=e.result;"200"===a?(i.success(r||"Suite saved successfully"),!t&&n&&n.testSuiteID?(v(n.testSuiteID),d(!0)):t&&d(!0)):i.error(r||"Failed to save test suite")}catch(a){i.error("Something went wrong")}finally{j(!1)}},onCancel:()=>S("/test-design/test-suite"),isUpdate:!!C,defaultValues:h,isSaving:b}),e.jsx("hr",{className:"my-6 border-gray-200"}),(o||c)&&e.jsx(m,{suiteId:c?C:y,onComplete:()=>S("/test-design/test-suite")},`test-suite-assignment-${c?C:y}`)]})};export{h as default};
