import{j as e}from"./chunk-D8bRv3Ag.js";import{R as s,a as t,u as a,r}from"./chunk-C74fWxxE.js";import{B as l}from"./chunk-BqYTYUrH.js";import{y as n}from"./chunk-Dw5YO7VD.js";import{g as i,K as d,M as o,E as c,N as m,O as u,P as p,e as x}from"../assets/index-DuCFfOeV.js";import{M as h}from"./chunk-D9EjM1vG.js";import"./chunk-SnPUoUoO.js";import"./chunk-4QNEI4IN.js";const b=s.memo((({formData:s,apiOptions:t,loading:a,loadingApis:r,selectedApiId:l,selectedApiDetails:n,onFieldChange:i})=>e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Test case name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"testCaseName",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:s.testCaseName,onChange:i,disabled:a})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"type",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:s.type,onChange:i,disabled:a,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"functional",children:"functional"}),e.jsx("option",{value:"performance",children:"performance"}),e.jsx("option",{value:"security",children:"security"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Response type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"responseType",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:s.responseType,onChange:i,disabled:a,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"json",children:"json"}),e.jsx("option",{value:"xml",children:"xml"}),e.jsx("option",{value:"text",children:"text"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"API"}),e.jsxs("select",{name:"api",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:s.api,onChange:i,disabled:a||r,children:[e.jsx("option",{value:"",children:"Select"}),t.map((s=>e.jsxs("option",{value:s.name,children:[s.name," (",s.method," ",s.url,")"]},s.id)))]}),r&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Loading API details..."}),l&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["âœ“ API associated (ID: ",l,")"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["API Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"apiType",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:s.apiType,onChange:i,disabled:a||n,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"GET",children:"GET"}),e.jsx("option",{value:"POST",children:"POST"}),e.jsx("option",{value:"PUT",children:"PUT"}),e.jsx("option",{value:"DELETE",children:"DELETE"}),e.jsx("option",{value:"PATCH",children:"PATCH"})]}),n&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Using method from selected API"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["URL ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"url",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:s.url,onChange:i,placeholder:"/api/endpoint",disabled:a||n}),n&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Using URL from selected API"})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{name:"description",rows:"3",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:s.description,onChange:i,disabled:a})]})]})));b.displayName="FormFields";const g=({parameters:s})=>0===s.length?null:e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-900 mb-2",children:"Detected Parameters"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(((s,t)=>e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full border border-blue-300",children:["$","{"+s+"}"]},t)))}),e.jsx("p",{className:"text-xs text-blue-700 mt-2",children:"ðŸ’¡ These parameters will be available for variable configuration after saving"})]}),f=({requestTemplate:s,responseTemplate:t,uploadedRequestFileName:a,uploadedResponseFileName:r,onRequestTemplateChange:l,onResponseTemplateChange:i,onRequestFileNameChange:d,onResponseFileNameChange:o,onShowPreview:c,loading:m})=>{const u=({id:s,type:t,template:a,fileName:r,label:u})=>e.jsxs("div",{children:[e.jsxs("label",{className:"block font-medium mb-2 text-sm",children:[u," ",e.jsx("span",{className:"text-gray-500",children:"(Optional)"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("input",{id:s,type:"file",accept:".json",className:"hidden",onChange:e=>((e,s)=>{const t=e.target.files[0];if(t&&"application/json"===t.type){const e=new FileReader;e.onload=e=>{try{const a=JSON.parse(e.target.result),r=JSON.stringify(a,null,2);"request"===s?(d(t.name),l(r)):(o(t.name),i(r))}catch(a){n.error("Invalid JSON file. Please check the file format.")}},e.readAsText(t)}else n.error("Please upload a valid JSON file.")})(e,t),disabled:m}),e.jsx("label",{htmlFor:s,className:"cursor-pointer border px-4 py-2 text-sm rounded bg-white hover:bg-gray-100 transition-colors "+(m?"opacity-50 cursor-not-allowed":""),children:"Click to upload"}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-gray-700 flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),r]}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-[#4F46E5] text-white text-sm rounded hover:bg-[#4338CA] transition-colors",onClick:()=>c({type:t,content:a}),disabled:m,children:"Preview"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Note: Parameters in templates are not used for variable detection"})]});return e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[e.jsx(u,{id:"request-template",type:"request",template:s,fileName:a,label:"Request template"}),e.jsx(u,{id:"response-template",type:"response",template:t,fileName:r,label:"Response template"})]})},y=({title:s,content:t,onClose:a})=>t?e.jsx(h,{isOpen:!!t,onClose:a,title:s,size:"2xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("pre",{className:"bg-gray-100 p-4 rounded-lg overflow-auto max-h-96 text-sm whitespace-pre-wrap font-mono border",children:t}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md transition-colors",children:"Close"})})]})}):null,j=e=>{if(!e)return[];const s=/\$\{([^}]+)\}/g,t=[];let a;for(;null!==(a=s.exec(e));)t.push(a[1]);return[...new Set(t)]},v=e=>{if(!e||"object"!=typeof e)return[];const s=[];return Object.entries(e).forEach((([e,t])=>{s.push(...j(e)),s.push(...j(String(t)))})),[...new Set(s)]},N=e=>{if(!e||"object"!=typeof e)return[];const s=[];return Object.entries(e).forEach((([e,t])=>{s.push(...j(e)),s.push(...j(String(t)))})),[...new Set(s)]},C=e=>{if(!e||"object"!=typeof e)return[];const s=[];return Object.entries(e).forEach((([e,t])=>{s.push(...j(e)),s.push(...j(String(t)))})),[...new Set(s)]},w=e=>{const s=[];if(e.url&&s.push(...j(e.url)),e.api&&e.api.request){const t=e.api.request;t.queryParams&&s.push(...v(t.queryParams)),t.headers&&s.push(...N(t.headers)),t.pathParams&&s.push(...C(t.pathParams))}return[...new Set(s)]},T=e=>{let s=[];if(e&&e.request){const t=e.request;t.queryParams&&s.push(...v(t.queryParams)),t.headers&&s.push(...N(t.headers)),t.pathParams&&s.push(...C(t.pathParams))}return[...new Set(s)]},S=({onParametersDetected:s,onTestCaseSaved:l})=>{const o=t(),c=a(),m=r.useMemo((()=>o.state?.testCase?.testCaseId),[o.state?.testCase?.testCaseId]),u=r.useMemo((()=>!!o.state?.testCase),[o.state?.testCase]),p=r.useRef(!1),x=r.useRef(null),[h,v]=r.useState(!1),[N,C]=r.useState(!1),[S,I]=r.useState([]),[P,k]=r.useState(null),[F,E]=r.useState(null),[A,q]=r.useState([]),[O,D]=r.useState({testCaseName:"",type:"",responseType:"",api:"",apiType:"",url:"",description:""}),[R,M]=r.useState(null),[L,V]=r.useState(""),[$,J]=r.useState(""),[U,G]=r.useState(""),[z,B]=r.useState(""),H=r.useCallback((()=>({userId:"302",transactionId:Date.now().toString(),timestamp:(new Date).toISOString()})),[]),Y=r.useCallback((e=>{s&&s(e)}),[s]),K=r.useCallback(((e,s)=>{l&&l(e,s)}),[l]);r.useEffect((()=>{(async()=>{C(!0);try{const e=await i("/api/v1/apirepos","GET");if(e?.result?.data){const s=e.result.data.content.map((e=>({id:e.apiId,name:e.apiRepoName,method:e.method,url:e.url})));I(s)}}catch(e){n.error("Failed to load APIs from repository"),I([{id:1,name:"LoginAPI",method:"POST",url:"/api/auth/login"},{id:2,name:"UserProfileAPI",method:"GET",url:"/api/users/${userId}"},{id:3,name:"ProductsAPI",method:"GET",url:"/api/products"},{id:4,name:"OrdersAPI",method:"POST",url:"/api/orders/${userId}"},{id:5,name:"PaymentAPI",method:"POST",url:"/api/payments"}])}finally{C(!1)}})()}),[]);const W=r.useCallback((()=>{const e=j(O.url),s=T(P),t=[...new Set([...e,...s])];q(t),t.length>0&&Y(t)}),[O.url,P,Y]),_=r.useCallback((async e=>{if(e)try{C(!0);const s=await i(`/api/v1/apirepos/${e}`,"GET");if(s?.result?.data){const t=s.result.data;k(t),E(e),D((e=>({...e,url:t.url,apiType:t.method}))),setTimeout(W,100)}else n.error("Invalid API data format")}catch(s){n.error("Failed to load API details")}finally{C(!1)}}),[W]);r.useEffect((()=>{if(!u||!m||p.current&&x.current===m)return;if(o.state?.testCase&&!o.state.testCase.testCaseId){const e=o.state.testCase;if(D({testCaseName:e.name||"",type:e.type||"",responseType:e.responseType||"",api:e.apiName||"",apiType:e.apiType||"",url:e.url||"",description:e.description||""}),e.apiId&&E(e.apiId),e.requestTemplate){const s="string"==typeof e.requestTemplate?e.requestTemplate:JSON.stringify(e.requestTemplate,null,2);G(s),V("existing-request.json")}if(e.responseTemplate){const s="string"==typeof e.responseTemplate?e.responseTemplate:JSON.stringify(e.responseTemplate,null,2);B(s),J("existing-response.json")}const s=w(e);q(s),Y(s),K(e.testCaseId,s)}else(async()=>{try{v(!0),p.current=!0,x.current=m;const e=await i(`/api/v1/test-cases/${m}`);if(e.result?.data){const s=e.result.data;if(D({testCaseName:s.name||"",type:s.type||"",responseType:s.responseType||"",api:s.apiName||"",apiType:s.apiType||"",url:s.url||"",description:s.description||""}),s.api&&s.api.apiId&&E(s.api.apiId),s.requestTemplate){const e="string"==typeof s.requestTemplate?s.requestTemplate:JSON.stringify(s.requestTemplate,null,2);G(e),V("existing-request.json")}if(s.responseTemplate){const e="string"==typeof s.responseTemplate?s.responseTemplate:JSON.stringify(s.responseTemplate,null,2);B(e),J("existing-response.json")}const t=w(s);q(t),Y(t),K(s.testCaseId,t),s.apiName&&s.api&&s.api.apiId&&await _(s.api.apiId)}}catch(e){n.error("Failed to load test case details"),p.current=!1,x.current=null}finally{v(!1)}})()}),[u,m,Y,K]),r.useEffect((()=>()=>{p.current=!1,x.current=null}),[m]);const Q=r.useCallback((e=>{const{name:s,value:t}=e.target;if(D((e=>({...e,[s]:t}))),"api"===s&&t){const e=S.find((e=>e.name===t));e?_(e.id):(k(null),E(null))}"url"===s&&setTimeout(W,100)}),[S,_,W]),X=r.useCallback((()=>{const e=[{field:"testCaseName",label:"Test case name"},{field:"type",label:"Type"},{field:"responseType",label:"Response type"},{field:"apiType",label:"API Type"},{field:"url",label:"URL"}].filter((({field:e})=>!O[e]));return!(e.length>0)||(n.error(`Please fill in the following required fields: ${e.map((e=>e.label)).join(", ")}`),!1)}),[O]),Z=r.useCallback((async()=>{if(X())try{v(!0);let s={},t={};if(U)try{s=JSON.parse(U)}catch(e){return void n.error("Invalid JSON in request template")}if(z)try{t=JSON.parse(z)}catch(e){return void n.error("Invalid JSON in response template")}const a={requestMetaData:H(),data:{name:O.testCaseName,type:O.type,responseType:O.responseType,apiName:O.api,apiType:O.apiType,url:O.url,description:O.description,executionOrder:1}};let r,l;U&&(a.data.requestTemplate=s),z&&(a.data.responseTemplate=t),F&&(a.data.apiId=F.toString()),u?(a.data.testCaseId=m,l=m,r=await i("/api/v1/test-cases","PUT",a),n.success("Test Case updated successfully!")):(r=await i("/api/v1/test-cases","POST",a),n.success("Test Case created successfully!"),l=r?.result?.data?.testCaseId);const d=j(O.url),o=T(P),c=[...new Set([...d,...o])];Y(c),K(l,c)}catch(e){n.error(e.message||"Failed to save test case")}finally{v(!1)}}),[X,U,z,H,O,F,u,m,P,Y,K]),ee=r.useCallback((()=>{c("/test-design/test-case")}),[c]);return e.jsxs("div",{className:"bg-white p-6 rounded border shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center",children:[e.jsx(d,{className:"mr-2 text-indigo-600"}),u?"Edit test case":"Create new test case"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[F&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm",children:["API ID: ",F]}),A.length>0&&e.jsxs("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm",children:[A.length," parameter",1!==A.length?"s":""," detected"]})]})]}),e.jsx(b,{formData:O,apiOptions:S,loading:h,loadingApis:N,selectedApiId:F,selectedApiDetails:P,onFieldChange:Q}),e.jsx(g,{parameters:A}),e.jsx(f,{requestTemplate:U,responseTemplate:z,uploadedRequestFileName:L,uploadedResponseFileName:$,onRequestTemplateChange:G,onResponseTemplateChange:B,onRequestFileNameChange:V,onResponseFileNameChange:J,onShowPreview:M,loading:h}),R&&e.jsx(y,{title:"request"===R.type?"Request Template":"Response Template",content:R.content,onClose:()=>M(null)}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx("button",{type:"button",onClick:ee,className:"px-4 py-2 border border-gray-300 rounded text-sm hover:bg-gray-50 hover:-translate-y-0.5 transition-all",disabled:h,children:"Cancel"}),e.jsx("button",{type:"button",onClick:Z,className:"px-4 py-2 bg-[#4F46E5] text-white rounded text-sm hover:bg-[#4338CA] hover:-translate-y-0.5 transition-all flex items-center "+(h?"opacity-50 cursor-not-allowed":""),disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"mr-2"}),u?"Update":"Save"]})})]})]})},I=({isOpen:s,isEdit:t,formData:a,onFormChange:r,onSave:l,onClose:n,loading:i,detectedParameters:d})=>e.jsxs(h,{isOpen:s,onClose:n,title:t?"Edit Variable":"Add New Variable",size:"md",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:a.name,onChange:e=>r("name",e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"variable_name",autoFocus:!0}),d?.includes(a.name)&&e.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"ðŸ’¡ This matches a detected parameter"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Value"}),e.jsx("input",{type:"text",value:a.value,onChange:e=>r("value",e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"variable value"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 border border-gray-300 rounded-md text-sm hover:bg-gray-50 hover:-translate-y-0.5 transition-all",disabled:i,children:"Cancel"}),e.jsxs("button",{type:"button",onClick:l,className:"px-4 py-2 bg-[#4F46E5] text-white text-sm rounded-md hover:bg-[#4338CA] hover:-translate-y-0.5 transition-all flex items-center",disabled:i,children:[i&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),t?"Update":"Create"]})]})]}),P=({detectedParameters:s=[],testCaseId:a})=>{const l=t(),[d,b]=r.useState("Variables"),[g,f]=r.useState([]),[y,j]=r.useState(1),[v,N]=r.useState(!1),[C,w]=r.useState(!1),[T,S]=r.useState(!1),[P,k]=r.useState(!1),[F,E]=r.useState(!1),[A,q]=r.useState(!1),[O,D]=r.useState(null),[R,M]=r.useState(null),[L,V]=r.useState({name:"",value:""}),$=a||l.state?.testCase?.testCaseId,J=s?.length||0,U=g.filter((e=>s?.includes(e.name))).length,G=J-U,z=()=>({userId:localStorage.getItem("userId")||"302",transactionId:Date.now().toString(),timestamp:(new Date).toISOString()}),B=r.useCallback(((e,s)=>{V((t=>({...t,[e]:s})))}),[]),H=r.useCallback((()=>{k(!1),E(!1),V({name:"",value:""}),M(null)}),[]),Y=r.useCallback((()=>{V({name:"",value:""}),k(!0)}),[]),K=r.useCallback((e=>{V({name:e.name||"",value:e.value||""}),M(e),E(!0)}),[]),W=async()=>{if($)try{N(!0);const e=await i(`/api/v1/variables/${$}`);if("200"===e.result?.code){const s=e.result.data||[];f(Array.isArray(s)?s:[])}else e.result,f([])}catch(e){e.message.includes("404")||e.message.toLowerCase().includes("not found")||n.error("Could not load existing variables, but you can still create new ones"),f([])}finally{N(!1),S(!0)}else S(!0)},_=async(e,s="")=>{try{const t={requestMetaData:z(),data:{name:e.trim(),value:s.trim(),source:"STATIC",testCase:{testCaseId:$}}},a=await i("/api/v1/variables","POST",t);if("200"===a.result?.code)return a.result.data;throw new Error(a.result?.message||"Failed to create variable")}catch(t){throw t}},Q=async()=>{const{name:e,value:s}=L;if(!e.trim())return void n.error("Variable name is required");if(g.find((s=>s.name.toLowerCase()===e.trim().toLowerCase()&&(!R||s.variableId!==R.variableId))))n.error("A variable with this name already exists");else try{N(!0),R?(await(async(e,s,t)=>{try{const a={requestMetaData:z(),data:{variableId:e,name:s.trim(),value:t.trim(),source:"STATIC",testCase:{testCaseId:$}}},r=await i("/api/v1/variables","PUT",a);if("200"===r.result?.code)return r.result.data;throw new Error(r.result?.message||"Failed to update variable")}catch(a){throw a}})(R.variableId,e,s),n.success("Variable updated successfully")):(await _(e,s),n.success("Variable created successfully")),await W(),H()}catch(t){n.error(t.message||"Failed to save variable")}finally{N(!1)}};r.useEffect((()=>{$?W():S(!0)}),[$]);const X=Math.ceil(g.length/6),Z=g.slice(6*(y-1),6*y);return T?e.jsxs("div",{className:"bg-white shadow p-6 rounded-lg mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("h2",{className:"text-md font-semibold flex items-center",children:[e.jsx(o,{className:"mr-2 text-gray-600"}),"Test case configuration"]}),J>0&&e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:[J," parameters detected"]}),G>0&&e.jsxs("span",{className:"bg-amber-100 text-amber-800 text-xs px-2 py-1 rounded-full",children:[G," not created"]}),0===G&&J>0&&e.jsxs("span",{className:"bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full flex items-center",children:[e.jsx(c,{className:"mr-1 h-3 w-3"}),"All parameters created"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[G>0&&e.jsx("button",{onClick:async()=>{if(s&&0!==s.length)if(0!==G){w(!0);try{const t=s.filter((e=>!g.some((s=>s.name===e))));let a=0,r=0;for(const s of t)try{await _(s,""),a++}catch(e){r++}a>0&&(n.success(`Created ${a} parameter variable${a>1?"s":""}`),await W()),r>0&&n.warning(`Failed to create ${r} parameter${r>1?"s":""}`)}catch(e){n.error("Error creating parameter variables")}finally{w(!1)}}else n.info("All detected parameters already have variables");else n.info("No parameters detected to create")},className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 hover:-translate-y-0.5 transition-all flex items-center",disabled:!$||v||C,children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white mr-1"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"mr-1"}),"Create All Parameters (",G,")"]})}),e.jsxs("button",{onClick:Y,className:"px-3 py-1 bg-[#4F46E5] text-white text-sm rounded hover:bg-[#4338CA] hover:-translate-y-0.5 transition-all flex items-center",disabled:!$||v,children:[e.jsx(u,{className:"mr-1"}),"Add Variable"]})]})]}),J>0&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded-md border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900 mb-1",children:["Detected Parameters: ",s.join(", ")]}),e.jsxs("div",{className:"text-xs text-blue-700",children:[U," of ",J," parameters have been created as variables"]})]}),G>0&&e.jsx("div",{className:"text-xs text-blue-600",children:'ðŸ’¡ Use "Create All Parameters" to automatically create variables for all detected parameters'})]})}),0===J&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-md border border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx(o,{className:"inline mr-2"}),"No parameters detected in your test case templates. You can still create variables manually to store reusable values."]})}),e.jsx("div",{className:"flex mb-4 border-b",children:["Variables","Functions"].map((s=>e.jsxs("button",{className:"py-2 px-4 font-medium "+(d===s?"border-b-2 border-[#4F46E5] text-[#4F46E5]":"text-gray-500"),onClick:()=>b(s),children:[s,"Variables"===s&&g.length>0&&e.jsx("span",{className:"ml-1 bg-gray-200 text-gray-700 text-xs px-1.5 py-0.5 rounded-full",children:g.length})]},s)))}),e.jsx("div",{className:"border rounded overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 text-left text-xs uppercase text-gray-500 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 font-medium",children:"Name"}),e.jsx("th",{className:"p-3 font-medium",children:"Value"}),e.jsx("th",{className:"p-3 font-medium",children:"Type"}),e.jsx("th",{className:"p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:v&&0===g.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-4 text-center",children:e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-[#4F46E5] mr-2"}),"Loading variables..."]})})}):0===Z.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-8 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(o,{className:"h-8 w-8 text-gray-300 mb-3"}),e.jsx("div",{className:"text-lg font-medium mb-2",children:"No variables created yet"}),e.jsx("div",{className:"text-sm mb-4",children:$?"Create variables to store reusable values for your test case":"Save the test case first to start creating variables"}),$&&e.jsxs("button",{onClick:Y,className:"px-4 py-2 bg-[#4F46E5] text-white text-sm rounded hover:bg-[#4338CA] hover:-translate-y-0.5 transition-all flex items-center",children:[e.jsx(u,{className:"mr-1"}),"Create Your First Variable"]})]})})}):Z.map((t=>{const a=s?.includes(t.name),r=t.value&&""!==t.value.trim();return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium",children:t.name}),a&&e.jsx("span",{className:"ml-2 bg-blue-100 text-blue-700 text-xs px-1.5 py-0.5 rounded-full",children:"Parameter"})]})}),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"truncate max-w-xs",children:r?e.jsx("span",{className:"text-gray-900",children:t.value}):e.jsx("span",{className:"text-gray-400 italic",children:"Empty"})})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"text-xs px-2 py-1 rounded-full "+(a?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:a?"Auto-detected":"Manual"})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>K(t),className:"text-gray-400 hover:text-[#4F46E5] transition-colors",title:"Edit variable",disabled:v,children:e.jsx(p,{size:16})}),e.jsx("button",{onClick:()=>(e=>{D(e),q(!0)})(t),className:"text-gray-400 hover:text-red-500 transition-colors",title:"Delete variable",disabled:v,children:e.jsx(x,{size:16})})]})})]},t.variableId)}))})]})}),(()=>{if(X<=1)return null;const s=[],t=Math.floor(2.5);let a=Math.max(1,y-t),r=Math.min(X,a+5-1);r-a<4&&(a=Math.max(1,r-5+1));for(let e=a;e<=r;e++)s.push(e);return e.jsxs("div",{className:"flex justify-end mt-4 space-x-1 text-sm",children:[e.jsx("button",{className:"px-3 py-1 border rounded hover:bg-gray-100 hover:-translate-y-0.5 disabled:opacity-40 disabled:hover:transform-none transition-all",disabled:1===y,onClick:()=>j(y-1),children:"Prev"}),a>1&&e.jsx("span",{className:"px-2",children:"..."}),s.map((s=>e.jsx("button",{onClick:()=>j(s),className:"px-3 py-1 rounded hover:-translate-y-0.5 transition-all "+(s===y?"bg-[#4F46E5] text-white":"border hover:bg-gray-100"),children:s},s))),r<X&&e.jsx("span",{className:"px-2",children:"..."}),e.jsx("button",{className:"px-3 py-1 border rounded hover:bg-gray-100 hover:-translate-y-0.5 disabled:opacity-40 disabled:hover:transform-none transition-all",disabled:y===X,onClick:()=>j(y+1),children:"Next"})]})})(),"Functions"===d&&e.jsxs("div",{className:"mt-4 p-8 text-center text-gray-500 bg-gray-50 rounded-md",children:[e.jsx(o,{className:"h-8 w-8 text-gray-300 mb-3 mx-auto"}),e.jsx("div",{className:"text-lg font-medium mb-2",children:"Functions Coming Soon"}),e.jsx("div",{className:"text-sm",children:"Function management will be available in a future update."})]}),e.jsx(I,{isOpen:P,isEdit:!1,formData:L,onFormChange:B,onSave:Q,onClose:H,loading:v,detectedParameters:s}),e.jsx(I,{isOpen:F,isEdit:!0,formData:L,onFormChange:B,onSave:Q,onClose:H,loading:v,detectedParameters:s}),e.jsx(h,{isOpen:A,onClose:()=>{q(!1),D(null)},title:"Delete Variable",size:"sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center w-12 h-12 rounded-full bg-red-100 mb-4",children:e.jsx(x,{className:"w-6 h-6 text-red-600"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Delete Variable"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-6",children:['Are you sure you want to delete "',O?.name,'"? This action cannot be undone.']}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:()=>{q(!1),D(null)},className:"px-4 py-2 border border-gray-300 rounded-md text-sm hover:bg-gray-50 hover:-translate-y-0.5 transition-all",disabled:v,children:"Cancel"}),e.jsxs("button",{onClick:async()=>{if(O)try{N(!0),await(async e=>{try{const s=await i(`/api/v1/variables/${e}`,"DELETE");if("200"===s.result?.code)return!0;throw new Error(s.result?.message||"Failed to delete variable")}catch(s){throw s}})(O.variableId),n.success("Variable deleted successfully"),await W()}catch(e){n.error(e.message||"Failed to delete variable")}finally{N(!1),q(!1),D(null)}},className:"px-4 py-2 bg-red-600 text-white text-sm rounded-md hover:bg-red-700 hover:-translate-y-0.5 transition-all flex items-center",disabled:v,children:[v&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Delete"]})]})]})})]}):e.jsx("div",{className:"bg-white shadow p-6 rounded-lg mt-8",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mr-3"}),e.jsx("span",{className:"text-gray-600",children:"Loading configuration..."})]})})},k=()=>{const n=t();a();const[i,d]=r.useState([]),[o,c]=r.useState(!1),[m,u]=r.useState(null),[p,x]=r.useState(!1),h=r.useMemo((()=>n.state?.testCase),[n.state?.testCase]),b=r.useMemo((()=>!!h),[h]),g=r.useMemo((()=>h?.testCaseId),[h?.testCaseId]),f=r.useCallback((e=>{d(e||[]),x(!0)}),[]),y=r.useCallback(((e,s=[])=>{u(e),c(!0),d(s||[]),x(!0)}),[]),j=r.useCallback((e=>{if(!e)return[];const s=/\$\{([^}]+)\}/g,t=[];let a;for(;null!==(a=s.exec(e));)t.push(a[1]);return t}),[]);return s.useEffect((()=>{if(b&&g){u(g),c(!0),x(!0);const e=[];if(h.url){const s=j(h.url);e.push(...s)}if(h.requestTemplate){const s=j(JSON.stringify(h.requestTemplate));e.push(...s)}if(h.responseTemplate){const s=j(JSON.stringify(h.responseTemplate));e.push(...s)}const s=[...new Set(e)];d(s)}}),[b,g,h,j]),e.jsxs("div",{className:"p-6",children:[e.jsx(l,{items:[{label:"Test Design"},{label:"Test Case",path:"/test-design/test-case"},{label:b?"Edit":"Create"}]}),e.jsx(S,{onParametersDetected:f,onTestCaseSaved:y}),(p||o||b)&&e.jsx(P,{detectedParameters:i,testCaseId:m||g},`config-${m||g}`)]})};export{k as default};
