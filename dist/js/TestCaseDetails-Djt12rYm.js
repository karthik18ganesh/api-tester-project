import{j as e}from"./chunk-BAZEzdRI.js";import{R as t,a as s,u as a,r}from"./chunk-N8EMqdL-.js";import{B as n}from"./chunk-DOqeVFSN.js";import{y as l}from"./chunk-CQIvISRI.js";import{g as i,Q as o,R as c,J as d,p as u,c as m,S as p,e as x,G as h,T as g,U as b,V as y,r as f,z as N,W as j,D as v}from"../assets/index-8TFbwAj4.js";import{M as S,B as T}from"./chunk-WRwurtKa.js";import{n as E}from"./chunk-BV3C3NLD.js";import"./chunk-MJHYApCa.js";import"./chunk-Cef-BAxw.js";const A=t.memo((({formData:t,apiOptions:s,loading:a,loadingApis:r,selectedApiId:n,selectedApiDetails:l,onFieldChange:i})=>e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Test case name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"testCaseName",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:t.testCaseName,onChange:i,disabled:a})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"type",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:t.type,onChange:i,disabled:a,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"functional",children:"functional"}),e.jsx("option",{value:"performance",children:"performance"}),e.jsx("option",{value:"security",children:"security"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Response type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"responseType",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:t.responseType,onChange:i,disabled:a,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"json",children:"json"}),e.jsx("option",{value:"xml",children:"xml"}),e.jsx("option",{value:"text",children:"text"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"API"}),e.jsxs("select",{name:"api",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:t.api,onChange:i,disabled:a||r,children:[e.jsx("option",{value:"",children:"Select"}),s.map((t=>e.jsxs("option",{value:t.name,children:[t.name," (",t.method," ",t.url,")"]},t.id)))]}),r&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Loading API details..."}),n&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["âœ“ API associated (ID: ",n,")"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["API Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"apiType",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:t.apiType,onChange:i,disabled:a||l,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"GET",children:"GET"}),e.jsx("option",{value:"POST",children:"POST"}),e.jsx("option",{value:"PUT",children:"PUT"}),e.jsx("option",{value:"DELETE",children:"DELETE"}),e.jsx("option",{value:"PATCH",children:"PATCH"})]}),l&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Using method from selected API"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["URL ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"url",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:t.url,onChange:i,placeholder:"/api/endpoint",disabled:a||l}),l&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Using URL from selected API"})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{name:"description",rows:"3",className:"border border-gray-300 rounded p-2 w-full focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:t.description,onChange:i,disabled:a})]})]})));A.displayName="FormFields";const C=({parameters:t})=>0===t.length?null:e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-900 mb-2",children:"Detected Parameters"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.map(((t,s)=>e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full border border-blue-300",children:["$","{"+t+"}"]},s)))}),e.jsx("p",{className:"text-xs text-blue-700 mt-2",children:"ðŸ’¡ These parameters will be available for variable configuration after saving"})]}),I=({requestTemplate:t,responseTemplate:s,uploadedRequestFileName:a,uploadedResponseFileName:r,onRequestTemplateChange:n,onResponseTemplateChange:i,onRequestFileNameChange:o,onResponseFileNameChange:c,onShowPreview:d,loading:u})=>{const m=({id:t,type:s,template:a,fileName:r,label:m})=>e.jsxs("div",{children:[e.jsxs("label",{className:"block font-medium mb-2 text-sm",children:[m," ",e.jsx("span",{className:"text-gray-500",children:"(Optional)"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("input",{id:t,type:"file",accept:".json",className:"hidden",onChange:e=>((e,t)=>{const s=e.target.files[0];if(s&&"application/json"===s.type){const e=new FileReader;e.onload=e=>{try{const a=JSON.parse(e.target.result),r=JSON.stringify(a,null,2);"request"===t?(o(s.name),n(r)):(c(s.name),i(r))}catch(a){l.error("Invalid JSON file. Please check the file format.")}},e.readAsText(s)}else l.error("Please upload a valid JSON file.")})(e,s),disabled:u}),e.jsx("label",{htmlFor:t,className:"cursor-pointer border px-4 py-2 text-sm rounded bg-white hover:bg-gray-100 transition-colors "+(u?"opacity-50 cursor-not-allowed":""),children:"Click to upload"}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-gray-700 flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),r]}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-[#4F46E5] text-white text-sm rounded hover:bg-[#4338CA] transition-colors",onClick:()=>d({type:s,content:a}),disabled:u,children:"Preview"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Note: Parameters in templates are not used for variable detection"})]});return e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[e.jsx(m,{id:"request-template",type:"request",template:t,fileName:a,label:"Request template"}),e.jsx(m,{id:"response-template",type:"response",template:s,fileName:r,label:"Response template"})]})},w=({title:t,content:s,onClose:a})=>s?e.jsx(S,{isOpen:!!s,onClose:a,title:t,size:"2xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("pre",{className:"bg-gray-100 p-4 rounded-lg overflow-auto max-h-96 text-sm whitespace-pre-wrap font-mono border",children:s}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md transition-colors",children:"Close"})})]})}):null,O=e=>{if(!e)return[];const t=/\$\{([^}]+)\}/g,s=[];let a;for(;null!==(a=t.exec(e));)s.push(a[1]);return[...new Set(s)]},P=e=>{if(!e||"object"!=typeof e)return[];const t=[];return Object.entries(e).forEach((([e,s])=>{t.push(...O(e)),t.push(...O(String(s)))})),[...new Set(t)]},R=e=>{if(!e||"object"!=typeof e)return[];const t=[];return Object.entries(e).forEach((([e,s])=>{t.push(...O(e)),t.push(...O(String(s)))})),[...new Set(t)]},_=e=>{if(!e||"object"!=typeof e)return[];const t=[];return Object.entries(e).forEach((([e,s])=>{t.push(...O(e)),t.push(...O(String(s)))})),[...new Set(t)]},V=e=>{const t=[];if(e.url&&t.push(...O(e.url)),e.api&&e.api.request){const s=e.api.request;s.queryParams&&t.push(...P(s.queryParams)),s.headers&&t.push(...R(s.headers)),s.pathParams&&t.push(..._(s.pathParams))}return[...new Set(t)]},k=e=>{let t=[];if(e&&e.request){const s=e.request;s.queryParams&&t.push(...P(s.queryParams)),s.headers&&t.push(...R(s.headers)),s.pathParams&&t.push(..._(s.pathParams))}return[...new Set(t)]},D=({onParametersDetected:t,onTestCaseSaved:n})=>{const c=s(),d=a(),u=r.useMemo((()=>c.state?.testCase?.testCaseId),[c.state?.testCase?.testCaseId]),m=r.useMemo((()=>!!c.state?.testCase),[c.state?.testCase]),p=r.useRef(!1),x=r.useRef(null),[h,g]=r.useState(!1),[b,y]=r.useState(!1),[f,N]=r.useState([]),[j,v]=r.useState(null),[S,T]=r.useState(null),[E,P]=r.useState([]),[R,_]=r.useState({testCaseName:"",type:"",responseType:"",api:"",apiType:"",url:"",description:""}),[D,L]=r.useState(null),[F,H]=r.useState(""),[$,M]=r.useState(""),[U,q]=r.useState(""),[J,G]=r.useState(""),X=r.useCallback((()=>({userId:"302",transactionId:Date.now().toString(),timestamp:(new Date).toISOString()})),[]),Q=r.useCallback((e=>{t&&t(e)}),[t]),z=r.useCallback(((e,t)=>{n&&n(e,t)}),[n]);r.useEffect((()=>{(async()=>{y(!0);try{const e=await i("/api/v1/apirepos","GET");if(e?.result?.data){const t=e.result.data.content.map((e=>({id:e.apiId,name:e.apiRepoName,method:e.method,url:e.url})));N(t)}}catch(e){l.error("Failed to load APIs from repository"),N([{id:1,name:"LoginAPI",method:"POST",url:"/api/auth/login"},{id:2,name:"UserProfileAPI",method:"GET",url:"/api/users/${userId}"},{id:3,name:"ProductsAPI",method:"GET",url:"/api/products"},{id:4,name:"OrdersAPI",method:"POST",url:"/api/orders/${userId}"},{id:5,name:"PaymentAPI",method:"POST",url:"/api/payments"}])}finally{y(!1)}})()}),[]);const Y=r.useCallback((()=>{const e=O(R.url),t=k(j),s=[...new Set([...e,...t])];P(s),s.length>0&&Q(s)}),[R.url,j,Q]),W=r.useCallback((async e=>{if(e)try{y(!0);const t=await i(`/api/v1/apirepos/${e}`,"GET");if(t?.result?.data){const s=t.result.data;v(s),T(e),_((e=>({...e,url:s.url,apiType:s.method}))),setTimeout(Y,100)}else l.error("Invalid API data format")}catch(t){l.error("Failed to load API details")}finally{y(!1)}}),[Y]);r.useEffect((()=>{if(!m||!u||p.current&&x.current===u)return;if(c.state?.testCase&&!c.state.testCase.testCaseId){const e=c.state.testCase;if(_({testCaseName:e.name||"",type:e.type||"",responseType:e.responseType||"",api:e.apiName||"",apiType:e.apiType||"",url:e.url||"",description:e.description||""}),e.apiId&&T(e.apiId),e.requestTemplate){const t="string"==typeof e.requestTemplate?e.requestTemplate:JSON.stringify(e.requestTemplate,null,2);q(t),H("existing-request.json")}if(e.responseTemplate){const t="string"==typeof e.responseTemplate?e.responseTemplate:JSON.stringify(e.responseTemplate,null,2);G(t),M("existing-response.json")}const t=V(e);P(t),Q(t),z(e.testCaseId,t)}else(async()=>{try{g(!0),p.current=!0,x.current=u;const e=await i(`/api/v1/test-cases/${u}`);if(e.result?.data){const t=e.result.data;if(_({testCaseName:t.name||"",type:t.type||"",responseType:t.responseType||"",api:t.apiName||"",apiType:t.apiType||"",url:t.url||"",description:t.description||""}),t.api&&t.api.apiId&&T(t.api.apiId),t.requestTemplate){const e="string"==typeof t.requestTemplate?t.requestTemplate:JSON.stringify(t.requestTemplate,null,2);q(e),H("existing-request.json")}if(t.responseTemplate){const e="string"==typeof t.responseTemplate?t.responseTemplate:JSON.stringify(t.responseTemplate,null,2);G(e),M("existing-response.json")}const s=V(t);P(s),Q(s),z(t.testCaseId,s),t.apiName&&t.api&&t.api.apiId&&await W(t.api.apiId)}}catch(e){l.error("Failed to load test case details"),p.current=!1,x.current=null}finally{g(!1)}})()}),[m,u,Q,z]),r.useEffect((()=>()=>{p.current=!1,x.current=null}),[u]);const B=r.useCallback((e=>{const{name:t,value:s}=e.target;if(_((e=>({...e,[t]:s}))),"api"===t&&s){const e=f.find((e=>e.name===s));e?W(e.id):(v(null),T(null))}"url"===t&&setTimeout(Y,100)}),[f,W,Y]),K=r.useCallback((()=>{const e=[{field:"testCaseName",label:"Test case name"},{field:"type",label:"Type"},{field:"responseType",label:"Response type"},{field:"apiType",label:"API Type"},{field:"url",label:"URL"}].filter((({field:e})=>!R[e]));return!(e.length>0)||(l.error(`Please fill in the following required fields: ${e.map((e=>e.label)).join(", ")}`),!1)}),[R]),Z=r.useCallback((async()=>{if(K())try{g(!0);let t={},s={};if(U)try{t=JSON.parse(U)}catch(e){return void l.error("Invalid JSON in request template")}if(J)try{s=JSON.parse(J)}catch(e){return void l.error("Invalid JSON in response template")}const a={requestMetaData:X(),data:{name:R.testCaseName,type:R.type,responseType:R.responseType,apiName:R.api,apiType:R.apiType,url:R.url,description:R.description,executionOrder:1}};let r,n;U&&(a.data.requestTemplate=t),J&&(a.data.responseTemplate=s),S&&(a.data.apiId=S.toString()),m?(a.data.testCaseId=u,n=u,r=await i("/api/v1/test-cases","PUT",a),l.success("Test Case updated successfully!")):(r=await i("/api/v1/test-cases","POST",a),l.success("Test Case created successfully!"),n=r?.result?.data?.testCaseId);const o=O(R.url),c=k(j),d=[...new Set([...o,...c])];Q(d),z(n,d)}catch(e){l.error(e.message||"Failed to save test case")}finally{g(!1)}}),[K,U,J,X,R,S,m,u,j,Q,z]),ee=r.useCallback((()=>{d("/test-design/test-case")}),[d]);return e.jsxs("div",{className:"bg-white p-6 rounded border shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center",children:[e.jsx(o,{className:"mr-2 text-indigo-600"}),m?"Edit test case":"Create new test case"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[S&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm",children:["API ID: ",S]}),E.length>0&&e.jsxs("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm",children:[E.length," parameter",1!==E.length?"s":""," detected"]})]})]}),e.jsx(A,{formData:R,apiOptions:f,loading:h,loadingApis:b,selectedApiId:S,selectedApiDetails:j,onFieldChange:B}),e.jsx(C,{parameters:E}),e.jsx(I,{requestTemplate:U,responseTemplate:J,uploadedRequestFileName:F,uploadedResponseFileName:$,onRequestTemplateChange:q,onResponseTemplateChange:G,onRequestFileNameChange:H,onResponseFileNameChange:M,onShowPreview:L,loading:h}),D&&e.jsx(w,{title:"request"===D.type?"Request Template":"Response Template",content:D.content,onClose:()=>L(null)}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx("button",{type:"button",onClick:ee,className:"px-4 py-2 border border-gray-300 rounded text-sm hover:bg-gray-50 hover:-translate-y-0.5 transition-all",disabled:h,children:"Cancel"}),e.jsx("button",{type:"button",onClick:Z,className:"px-4 py-2 bg-[#4F46E5] text-white rounded text-sm hover:bg-[#4338CA] hover:-translate-y-0.5 transition-all flex items-center "+(h?"opacity-50 cursor-not-allowed":""),disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"mr-2"}),m?"Update":"Save"]})})]})]})},L={STATUS_CODE:"STATUS_CODE",RESPONSE_TIME:"RESPONSE_TIME",JSON_PATH:"JSON_PATH",CONTAINS:"CONTAINS",REGEX:"REGEX",HEADER_VALIDATION:"HEADER_VALIDATION",CONTENT_TYPE:"CONTENT_TYPE",RESPONSE_SIZE:"RESPONSE_SIZE",CUSTOM_SCRIPT:"CUSTOM_SCRIPT"},F={EQUALS:"EQUALS",NOT_EQUALS:"NOT_EQUALS",CONTAINS:"CONTAINS",NOT_CONTAINS:"NOT_CONTAINS",STARTS_WITH:"STARTS_WITH",ENDS_WITH:"ENDS_WITH",GREATER_THAN:"GREATER_THAN",LESS_THAN:"LESS_THAN",GREATER_THAN_OR_EQUAL:"GREATER_THAN_OR_EQUAL",LESS_THAN_OR_EQUAL:"LESS_THAN_OR_EQUAL",REGEX_MATCH:"REGEX_MATCH",EXISTS:"EXISTS",NOT_EXISTS:"NOT_EXISTS",IS_EMPTY:"IS_EMPTY",IS_NOT_EMPTY:"IS_NOT_EMPTY"},H=({target:e="",operator:t=F.EQUALS,expectedValue:s="",caseSensitive:a=!1,customMessage:r="",timeout:n=5e3,retryCount:l=0}={})=>({target:e,operator:t,expectedValue:s,caseSensitive:a,customMessage:r,timeout:n,retryCount:l}),$=({id:e=null,testCaseId:t=null,name:s="",description:a="",type:r=L.JSON_PATH,isEnabled:n=!0,priority:l=1,config:i=H(),createdBy:o=null,createdAt:c=null,updatedAt:d=null}={})=>({id:e,testCaseId:t,name:s,description:a,type:r,isEnabled:n,priority:l,config:i,createdBy:o,createdAt:c,updatedAt:d}),M=({id:e=null,assertionId:t=null,name:s="",type:a="",status:r="PENDING",actualValue:n=null,expectedValue:l=null,executionTime:i=0,error:o=null,details:c=null,path:d=null}={})=>({id:e,assertionId:t,name:s,type:a,status:r,actualValue:n,expectedValue:l,executionTime:i,error:o,details:c,path:d}),U={API_HEALTH_CHECK:{name:"API Health Check",description:"Basic API health validation",assertions:[{name:"Status Code 200",type:L.STATUS_CODE,config:H({target:"response.status",operator:F.EQUALS,expectedValue:"200"})},{name:"Response Time < 2s",type:L.RESPONSE_TIME,config:H({target:"execution.responseTime",operator:F.LESS_THAN,expectedValue:"2000"})}]},JSON_RESPONSE_VALIDATION:{name:"JSON Response Validation",description:"Validate JSON response structure and data",assertions:[{name:"Response is JSON",type:L.HEADER_VALIDATION,config:H({target:"response.headers.content-type",operator:F.CONTAINS,expectedValue:"application/json"})},{name:"Data exists",type:L.JSON_PATH,config:H({target:"response.body.data",operator:F.EXISTS})}]},USER_DATA_VALIDATION:{name:"User Data Validation",description:"Validate user-related API responses",assertions:[{name:"User ID exists",type:L.JSON_PATH,config:H({target:"response.body.data.id",operator:F.EXISTS})},{name:"Email format validation",type:L.JSON_PATH,config:H({target:"response.body.data.email",operator:F.REGEX_MATCH,expectedValue:"^[^@]+@[^@]+\\.[^@]+$"})}]}},q=e=>({[L.STATUS_CODE]:{label:"Status Code",description:"Validate HTTP response status code",icon:"SC",targetPlaceholder:"response.status",supportedOperators:[F.EQUALS,F.NOT_EQUALS,F.GREATER_THAN,F.LESS_THAN]},[L.RESPONSE_TIME]:{label:"Response Time",description:"Validate API response time",icon:"RT",targetPlaceholder:"execution.responseTime",supportedOperators:[F.LESS_THAN,F.GREATER_THAN,F.LESS_THAN_OR_EQUAL,F.GREATER_THAN_OR_EQUAL]},[L.JSON_PATH]:{label:"JSON Path",description:"Validate specific JSON response values",icon:"JP",targetPlaceholder:"response.body.data.field",supportedOperators:Object.values(F)},[L.CONTAINS]:{label:"Contains Text",description:"Check if response contains specific text",icon:"CT",targetPlaceholder:"response.body",supportedOperators:[F.CONTAINS,F.NOT_CONTAINS]},[L.HEADER_VALIDATION]:{label:"Header Validation",description:"Validate HTTP response headers",icon:"HV",targetPlaceholder:"response.headers.content-type",supportedOperators:[F.EQUALS,F.CONTAINS,F.EXISTS,F.NOT_EXISTS]},[L.REGEX]:{label:"Regular Expression",description:"Validate using regular expressions",icon:"RX",targetPlaceholder:"response.body.field",supportedOperators:[F.REGEX_MATCH]}}[e]||{label:e,description:"Custom assertion type",icon:"CA",targetPlaceholder:"",supportedOperators:[F.EQUALS]}),J=e=>{const t=[];return e.name?.trim()||t.push("Assertion name is required"),e.type||t.push("Assertion type is required"),e.config?.target?.trim()||e.type===L.RESPONSE_TIME||t.push("Target path is required"),e.config?.operator||t.push("Operator is required"),e.type!==L.REGEX||e.config?.expectedValue||t.push("Regular expression pattern is required"),e.type!==L.RESPONSE_TIME||e.config?.expectedValue||[F.EXISTS,F.NOT_EXISTS].includes(e.config?.operator)||t.push("Expected value is required for response time assertions"),{isValid:0===t.length,errors:t}};class G{static getValue(e,t){if(t&&e)try{if("response"===t)return e;if("response.status"===t)return e.status;if("response.body"===t)return e.data||e.body;if("response.headers"===t)return e.headers;const s=t.replace(/^response\./,"").split(".");let a=e;for(const e of s){if(null==a)return;if(e.includes("[")&&e.includes("]")){const[t,s]=e.split("["),r=parseInt(s.replace("]",""));t&&(a=a[t]),Array.isArray(a)&&!isNaN(r)&&(a=a[r])}else a=a[e]}return a}catch(s){return}}static exists(e,t){const s=this.getValue(e,t);return null!=s}}class X{static evaluate(e,t,s,a=!1){const r=a?e:String(e||"").toLowerCase(),n=a?s:String(s||"").toLowerCase();switch(t){case F.EQUALS:return r===n;case F.NOT_EQUALS:return r!==n;case F.CONTAINS:return String(r).includes(String(n));case F.NOT_CONTAINS:return!String(r).includes(String(n));case F.STARTS_WITH:return String(r).startsWith(String(n));case F.ENDS_WITH:return String(r).endsWith(String(n));case F.GREATER_THAN:return Number(e)>Number(s);case F.LESS_THAN:return Number(e)<Number(s);case F.GREATER_THAN_OR_EQUAL:return Number(e)>=Number(s);case F.LESS_THAN_OR_EQUAL:return Number(e)<=Number(s);case F.REGEX_MATCH:try{return new RegExp(s).test(String(e))}catch(l){throw new Error(`Invalid regex pattern: ${s}`)}case F.EXISTS:return null!=e;case F.NOT_EXISTS:return null==e;case F.IS_EMPTY:return!e||Array.isArray(e)&&0===e.length||"object"==typeof e&&0===Object.keys(e).length||""===String(e).trim();case F.IS_NOT_EMPTY:return e&&!(Array.isArray(e)&&0===e.length)&&!("object"==typeof e&&0===Object.keys(e).length)&&""!==String(e).trim();default:throw new Error(`Unsupported operator: ${t}`)}}}class Q{static executeStatusCodeAssertion(e,t,s){const{config:a}=e,r=t.status,n=a.expectedValue,l=X.evaluate(r,a.operator,n);return M({id:E(),assertionId:e.id,name:e.name,type:e.type,status:l?"PASSED":"FAILED",actualValue:r,expectedValue:n,path:"response.status",error:l?null:`Expected status ${a.operator} ${n}, but got ${r}`})}static executeResponseTimeAssertion(e,t,s){const{config:a}=e,r=s.responseTime||s.executionTimeMs||0,n=Number(a.expectedValue),l=X.evaluate(r,a.operator,n);return M({id:E(),assertionId:e.id,name:e.name,type:e.type,status:l?"PASSED":"FAILED",actualValue:`${r}ms`,expectedValue:`${n}ms`,path:"execution.responseTime",error:l?null:`Expected response time ${a.operator} ${n}ms, but got ${r}ms`})}static executeJsonPathAssertion(e,t,s){const{config:a}=e;try{const s=G.getValue(t,a.target);if(a.operator===F.EXISTS){const s=G.exists(t,a.target);return M({id:E(),assertionId:e.id,name:e.name,type:e.type,status:s?"PASSED":"FAILED",actualValue:s?"exists":"not found",expectedValue:"exists",path:a.target,error:s?null:`Path '${a.target}' does not exist in response`})}if(a.operator===F.NOT_EXISTS){const s=G.exists(t,a.target);return M({id:E(),assertionId:e.id,name:e.name,type:e.type,status:s?"FAILED":"PASSED",actualValue:s?"exists":"not found",expectedValue:"not exists",path:a.target,error:s?`Path '${a.target}' exists but should not`:null})}if(!G.exists(t,a.target))return M({id:E(),assertionId:e.id,name:e.name,type:e.type,status:"FAILED",actualValue:"not found",expectedValue:a.expectedValue,path:a.target,error:`Path '${a.target}' does not exist in response`});const r=X.evaluate(s,a.operator,a.expectedValue,a.caseSensitive);return M({id:E(),assertionId:e.id,name:e.name,type:e.type,status:r?"PASSED":"FAILED",actualValue:s,expectedValue:a.expectedValue,path:a.target,error:r?null:this.generateErrorMessage(s,a)})}catch(r){return M({id:E(),assertionId:e.id,name:e.name,type:e.type,status:"ERROR",actualValue:null,expectedValue:a.expectedValue,path:a.target,error:`Assertion execution error: ${r.message}`})}}static executeHeaderValidation(e,t,s){const{config:a}=e;try{const s=t.headers||{},r=a.target.replace("response.headers.",""),n=s[r]||s[r.toLowerCase()];if(a.operator===F.EXISTS){const t=void 0!==n;return M({id:E(),assertionId:e.id,name:e.name,type:e.type,status:t?"PASSED":"FAILED",actualValue:t?n:"not found",expectedValue:"exists",path:a.target,error:t?null:`Header '${r}' does not exist`})}const l=X.evaluate(n,a.operator,a.expectedValue,a.caseSensitive);return M({id:E(),assertionId:e.id,name:e.name,type:e.type,status:l?"PASSED":"FAILED",actualValue:n||"not found",expectedValue:a.expectedValue,path:a.target,error:l?null:this.generateErrorMessage(n,a)})}catch(r){return M({id:E(),assertionId:e.id,name:e.name,type:e.type,status:"ERROR",actualValue:null,expectedValue:a.expectedValue,path:a.target,error:`Header validation error: ${r.message}`})}}static executeContainsAssertion(e,t,s){const{config:a}=e;try{let s;s="response.body"===a.target||"response"===a.target?"string"==typeof t.data?t.data:JSON.stringify(t.data):G.getValue(t,a.target);const r=X.evaluate(s,F.CONTAINS,a.expectedValue,a.caseSensitive);return M({id:E(),assertionId:e.id,name:e.name,type:e.type,status:r?"PASSED":"FAILED",actualValue:s,expectedValue:a.expectedValue,path:a.target,error:r?null:`Expected to contain '${a.expectedValue}' but was '${s}'`})}catch(r){return M({id:E(),assertionId:e.id,name:e.name,type:e.type,status:"ERROR",actualValue:null,expectedValue:a.expectedValue,path:a.target,error:`Contains assertion error: ${r.message}`})}}static generateErrorMessage(e,t){const{operator:s,expectedValue:a}=t;switch(s){case F.EQUALS:return`Expected '${a}' but was '${e}'`;case F.NOT_EQUALS:return`Expected not to equal '${a}' but was '${e}'`;case F.CONTAINS:return`Expected to contain '${a}' but was '${e}'`;case F.NOT_CONTAINS:return`Expected not to contain '${a}' but was '${e}'`;case F.GREATER_THAN:return`Expected greater than ${a} but was ${e}`;case F.LESS_THAN:return`Expected less than ${a} but was ${e}`;case F.REGEX_MATCH:return`Expected to match pattern '${a}' but was '${e}'`;default:return`Assertion failed: expected ${s} '${a}' but was '${e}'`}}}class z{static async executeAssertion(e,t,s={}){const a=Date.now();try{let r;switch(e.type){case L.STATUS_CODE:r=Q.executeStatusCodeAssertion(e,t,s);break;case L.RESPONSE_TIME:r=Q.executeResponseTimeAssertion(e,t,s);break;case L.JSON_PATH:r=Q.executeJsonPathAssertion(e,t,s);break;case L.HEADER_VALIDATION:r=Q.executeHeaderValidation(e,t,s);break;case L.CONTAINS:r=Q.executeContainsAssertion(e,t,s);break;default:r=M({id:E(),assertionId:e.id,name:e.name,type:e.type,status:"ERROR",error:`Unsupported assertion type: ${e.type}`})}return r.executionTime=Date.now()-a,r}catch(r){return M({id:E(),assertionId:e.id,name:e.name,type:e.type,status:"ERROR",executionTime:Date.now()-a,error:`Assertion execution error: ${r.message}`})}}static async executeAssertions(e,t,s={}){const a=[],r=[...e].filter((e=>e.isEnabled)).sort(((e,t)=>(e.priority||1)-(t.priority||1)));for(const n of r){const e=await this.executeAssertion(n,t,s);if(a.push(e),"FAILED"===e.status&&n.stopOnFailure)break}return a}static calculateAssertionSummary(e){const t={total:e.length,passed:0,failed:0,errors:0,skipped:0,successRate:0,totalExecutionTime:0};return e.forEach((e=>{switch(e.status){case"PASSED":t.passed++;break;case"FAILED":t.failed++;break;case"ERROR":t.errors++;break;case"SKIPPED":t.skipped++}t.totalExecutionTime+=e.executionTime||0})),t.total>0&&(t.successRate=Math.round(t.passed/t.total*100)),t}}const Y=({isOpen:t,isEdit:s,assertion:a=null,onSave:n,onClose:l,sampleResponse:i=null})=>{const[o,p]=r.useState((()=>a?{name:a.name||"",description:a.description||"",type:a.type||L.JSON_PATH,isEnabled:void 0===a.isEnabled||a.isEnabled,config:{target:a.config?.target||"",operator:a.config?.operator||F.EQUALS,expectedValue:a.config?.expectedValue||"",caseSensitive:a.config?.caseSensitive||!1,customMessage:a.config?.customMessage||"",timeout:a.config?.timeout||5e3,retryCount:a.config?.retryCount||0}}:{name:"",description:"",type:L.JSON_PATH,isEnabled:!0,config:H()})),[x,h]=r.useState({}),[g,b]=r.useState(null),[y,f]=r.useState(!1),[N,j]=r.useState(!1),v=q(o.type),E=(e,t)=>{p((s=>({...s,[e]:t}))),x[e]&&h((t=>({...t,[e]:void 0})))},A=(e,t)=>{p((s=>({...s,config:{...s.config,[e]:t}}))),x[`config.${e}`]&&h((t=>({...t,[`config.${e}`]:void 0})))};return e.jsx(S,{isOpen:t,onClose:l,title:s?"Edit Assertion":"Create Assertion",size:"2xl",children:e.jsxs("form",{onSubmit:e=>{e.preventDefault();const t=$(o),s=J(t);if(!s.isValid){const e={};return s.errors.forEach((t=>{t.includes("name")?e.name=t:t.includes("type")?e.type=t:t.includes("target")?e["config.target"]=t:t.includes("operator")?e["config.operator"]=t:t.includes("expectedValue")?e["config.expectedValue"]=t:e.general=t})),void h(e)}n(t)},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:s?"Edit Assertion":"Create Assertion"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Configure validation rules for API responses"})]}),!s&&e.jsx(T,{type:"button",onClick:()=>j(!N),variant:"secondary",size:"sm",icon:c,children:"Templates"})]}),N&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Quick Start Templates"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.entries(U).map((([t,s])=>e.jsxs("button",{type:"button",onClick:()=>(e=>{const t=e.assertions[0];t&&(p((e=>({...e,name:t.name,type:t.type,config:{...t.config}}))),j(!1),b(null))})(s),className:"text-left p-3 bg-white rounded border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-colors",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),e.jsxs("p",{className:"text-xs text-blue-600 mt-2",children:[s.assertions.length," assertion",s.assertions.length>1?"s":""]})]},t)))})]}),x.general&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:e.jsx("p",{className:"text-sm text-red-600",children:x.general})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assertion Name *"}),e.jsx("input",{type:"text",value:o.name,onChange:e=>E("name",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(x.name?"border-red-300":"border-gray-300"),placeholder:"e.g., Validate user ID exists"}),x.name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:x.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:o.description,onChange:e=>E("description",e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Optional description of what this assertion validates"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assertion Type *"}),e.jsx("select",{value:o.type,onChange:e=>(e=>{const t=q(e),s=t.supportedOperators[0]||F.EQUALS;p((a=>({...a,type:e,config:{...a.config,target:t.targetPlaceholder||a.config.target,operator:s,expectedValue:""}}))),b(null)})(e.target.value),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(x.type?"border-red-300":"border-gray-300"),children:Object.entries(L).map((([t,s])=>{const a=q(s);return e.jsx("option",{value:s,children:a.label},t)}))}),x.type&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:x.type}),e.jsx("div",{className:"mt-2 p-2 bg-blue-50 rounded border border-blue-200",children:e.jsx("p",{className:"text-sm text-blue-700",children:v.description})})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.isEnabled,onChange:e=>E("isEnabled",e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Enabled"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[o.type!==L.RESPONSE_TIME&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Target Path *"}),e.jsx("input",{type:"text",value:o.config.target,onChange:e=>A("target",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(x["config.target"]?"border-red-300":"border-gray-300"),placeholder:v.targetPlaceholder}),x["config.target"]&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:x["config.target"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Use dot notation for nested objects: response.body.data.field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Operator *"}),e.jsx("select",{value:o.config.operator,onChange:e=>A("operator",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(x["config.operator"]?"border-red-300":"border-gray-300"),children:v.supportedOperators.map((t=>e.jsx("option",{value:t,children:t.replace(/_/g," ").toLowerCase()},t)))}),x["config.operator"]&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:x["config.operator"]})]}),![F.EXISTS,F.NOT_EXISTS,F.IS_EMPTY,F.IS_NOT_EMPTY].includes(o.config.operator)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expected Value *"}),e.jsx("input",{type:"text",value:o.config.expectedValue,onChange:e=>A("expectedValue",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(x["config.expectedValue"]?"border-red-300":"border-gray-300"),placeholder:o.type===L.REGEX?"Regular expression pattern":o.type===L.RESPONSE_TIME?"Time in milliseconds":"Expected value to compare against"}),x["config.expectedValue"]&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:x["config.expectedValue"]})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.config.caseSensitive,onChange:e=>A("caseSensitive",e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Case sensitive comparison"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Custom Error Message"}),e.jsx("input",{type:"text",value:o.config.customMessage,onChange:e=>A("customMessage",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Optional custom error message"})]}),i&&e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Test Assertion"}),e.jsx(T,{type:"button",onClick:async()=>{if(!i)return;const e=J({...o});if(e.isValid)try{f(!0);const e=$({...o,id:"temp-test"}),t=await z.executeAssertion(e,i,{responseTime:500});b(t)}catch(t){b({status:"ERROR",error:t.message})}finally{f(!1)}else h(e.errors.reduce(((e,t)=>(e.general=t,e)),{}))},disabled:y,variant:"success",size:"sm",loading:y,icon:d,children:"Test"})]}),g&&e.jsxs("div",{className:"p-3 rounded border "+("PASSED"===g.status?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:["PASSED"===g.status?e.jsx(u,{className:"w-4 h-4 text-green-600"}):e.jsx(m,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"PASSED"===g.status?"text-green-700":"text-red-700",children:g.status}),g.executionTime&&e.jsxs("span",{className:"text-gray-500",children:["(",g.executionTime,"ms)"]})]}),void 0!==g.actualValue&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Actual: "}),e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:JSON.stringify(g.actualValue)})]}),g.error&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:g.error})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[e.jsx(T,{type:"button",onClick:l,variant:"secondary",size:"md",children:"Cancel"}),e.jsx(T,{type:"submit",variant:"primary",size:"md",children:s?"Update Assertion":"Create Assertion"})]})]})})},W=({testCaseId:t,sampleResponse:s=null,onAssertionsChange:a=()=>{},readOnly:n=!1})=>{const[i,o]=r.useState([]),[c,u]=r.useState(!1),[m,b]=r.useState(!1),[y,f]=r.useState(!1),[N,j]=r.useState(null),[v,S]=r.useState({}),[E,A]=r.useState([]),C=r.useCallback((async()=>{if(t)try{u(!0);const e=await p.getByTestCase(t);if("200"===e.result?.code){const t=e.result.data||[];o(Array.isArray(t)?t:[])}else e.result,o([])}catch(e){l.error("Failed to load assertions"),o([])}finally{u(!1)}}),[t]);r.useEffect((()=>{C()}),[C]),r.useEffect((()=>{a(i)}),[i,a]);const I=()=>{b(!1),f(!1),j(null)};return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Assertions"}),e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:[i.length," configured"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s&&e.jsxs("button",{onClick:async()=>{if(s)try{u(!0);const e=await z.executeAssertions(i,s,{responseTime:500}),t={};e.forEach((e=>{t[e.assertionId]=e})),S(t);const a=z.calculateAssertionSummary(e);l.success(`Test completed: ${a.passed}/${a.total} passed`)}catch(e){l.error("Failed to test assertions")}finally{u(!1)}else l.warning("No sample response available for testing")},disabled:c||0===i.length,className:"px-3 py-2 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(d,{className:"w-4 h-4"}),"Test All"]}),E.length>0&&!n&&e.jsxs("button",{onClick:async()=>{if(0!==E.length)try{u(!0),await p.bulkDelete(E),l.success(`${E.length} assertions deleted`),A([]),await C()}catch(e){l.error("Failed to delete assertions")}finally{u(!1)}},className:"px-3 py-2 bg-red-600 text-white text-sm rounded-md hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4"}),"Delete (",E.length,")"]}),!n&&e.jsx(T,{onClick:()=>b(!0),variant:"primary",size:"sm",icon:h,children:"Add Assertion"})]})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:c&&0===i.length?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading assertions..."})]}):0===i.length?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(g,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No assertions configured"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Add assertions to validate API responses automatically"}),!n&&e.jsx(T,{onClick:()=>b(!0),variant:"primary",size:"md",icon:h,children:"Add Your First Assertion"})]}):e.jsxs(e.Fragment,{children:[!n&&i.length>1&&e.jsx("div",{className:"p-3 bg-gray-50 border-b border-gray-200",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:E.length===i.length,onChange:()=>{E.length===i.length?A([]):A(i.map((e=>e.assertionId||e.id)))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),"Select All (",i.length,")"]})}),i.map(((t,a)=>{const r=q(t.type),i=t.assertionId||t.id,o=v[i];return e.jsx(B,{assertion:t,typeInfo:r,testResult:o,isSelected:E.includes(i),onToggleSelect:()=>{return e=i,void A((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]));var e},onEdit:()=>(e=>{j(e),f(!0)})(t),onDelete:()=>(async e=>{try{u(!0),await p.delete(e),l.success("Assertion deleted successfully"),await C()}catch(t){l.error("Failed to delete assertion")}finally{u(!1)}})(i),onClone:()=>(e=>{const t={...e,id:void 0,assertionId:void 0,name:`${e.name} (Copy)`};j(t),b(!0)})(t),onTest:()=>(async e=>{if(s)try{const t=await z.executeAssertion(e,s,{responseTime:500});S((s=>({...s,[e.assertionId||e.id]:t}))),l.success(`Assertion test completed: ${t.status}`)}catch(t){l.error("Failed to test assertion")}else l.warning("No sample response available for testing")})(t),readOnly:n,showSampleTest:!!s},i)}))]})}),(m||y)&&e.jsx(Y,{isOpen:m||y,isEdit:y,assertion:N,onSave:async e=>{try{if(u(!0),N){const{id:t,createdBy:s,createdAt:a,updatedAt:r,priority:n,testCaseId:i,...o}=e;await p.update(N.assertionId,o),l.success("Assertion updated successfully")}else{const{id:s,createdBy:a,createdAt:r,updatedAt:n,priority:i,...o}=e;await p.create({...o,testCaseId:t}),l.success("Assertion created successfully")}await C(),I()}catch(s){l.error(`Failed to ${N?"update":"create"} assertion`)}finally{u(!1)}},onClose:I,sampleResponse:s})]})},B=({assertion:t,typeInfo:s,testResult:a,isSelected:r,onToggleSelect:n,onEdit:l,onDelete:i,onClone:o,onTest:c,readOnly:p,showSampleTest:h})=>e.jsx("div",{className:"p-4 hover:bg-gray-50 transition-colors "+(r?"bg-blue-50":""),children:e.jsxs("div",{className:"flex items-start gap-3",children:[!p&&e.jsx("input",{type:"checkbox",checked:r,onChange:n,className:"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"bg-blue-100 text-blue-700 text-xs px-1.5 py-0.5 rounded font-mono font-semibold",children:s.icon}),e.jsx("h4",{className:"font-medium text-gray-900",children:t.name}),e.jsx("span",{className:"bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded-full",children:s.label}),!t.isEnabled&&e.jsx("span",{className:"bg-gray-200 text-gray-500 text-xs px-2 py-1 rounded-full",children:"Disabled"})]}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:t.description}),e.jsxs("div",{className:"text-sm text-gray-500 space-y-1",children:[e.jsxs("div",{children:["Target: ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:t.config.target})]}),e.jsxs("div",{children:["Condition: ",e.jsx("span",{className:"font-medium",children:t.config.operator}),t.config.expectedValue&&e.jsxs(e.Fragment,{children:[" ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:t.config.expectedValue})]})]})]}),a&&e.jsxs("div",{className:"mt-2 p-2 rounded border border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:["PASSED"===a.status?e.jsx(u,{className:"w-4 h-4 text-green-600"}):e.jsx(m,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"PASSED"===a.status?"text-green-700":"text-red-700",children:a.status}),e.jsxs("span",{className:"text-gray-500",children:["(",a.executionTime,"ms)"]})]}),a.error&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:a.error})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[h&&e.jsx("button",{onClick:c,className:"p-1 text-gray-400 hover:text-green-600 transition-colors",title:"Test assertion",children:e.jsx(d,{className:"w-4 h-4"})}),e.jsx("button",{onClick:o,className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Clone assertion",children:e.jsx(b,{className:"w-4 h-4"})}),!p&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:l,className:"p-1 text-gray-400 hover:text-indigo-600 transition-colors",title:"Edit assertion",children:e.jsx(y,{className:"w-4 h-4"})}),e.jsx("button",{onClick:i,className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Delete assertion",children:e.jsx(x,{className:"w-4 h-4"})})]})]})]})})]})}),K=({isOpen:t,isEdit:s,formData:a,onFormChange:r,onSave:n,onClose:l,loading:i,detectedParameters:o})=>e.jsxs(S,{isOpen:t,onClose:l,title:s?"Edit Variable":"Add New Variable",size:"md",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:a.name,onChange:e=>r("name",e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"variable_name",autoFocus:!0}),o?.includes(a.name)&&e.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"ðŸ’¡ This matches a detected parameter"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Value"}),e.jsx("input",{type:"text",value:a.value,onChange:e=>r("value",e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"variable value"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 border border-gray-300 rounded-md text-sm hover:bg-gray-50 hover:-translate-y-0.5 transition-all",disabled:i,children:"Cancel"}),e.jsxs("button",{type:"button",onClick:n,className:"px-4 py-2 bg-[#4F46E5] text-white text-sm rounded-md hover:bg-[#4338CA] hover:-translate-y-0.5 transition-all flex items-center",disabled:i,children:[i&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),s?"Update":"Create"]})]})]}),Z=({detectedParameters:t=[],testCaseId:a})=>{const n=s(),[o,c]=r.useState("Variables"),[d,u]=r.useState([]),[m,p]=r.useState([]),[g,b]=r.useState(1),[T,E]=r.useState(!1),[A,C]=r.useState(!1),[I,w]=r.useState(!1),[O,P]=r.useState(!1),[R,_]=r.useState(!1),[V,k]=r.useState(!1),[D,L]=r.useState(null),[F,H]=r.useState(null),[$,M]=r.useState({name:"",value:""}),U=a||n.state?.testCase?.testCaseId,q=t?.length||0,J=d.filter((e=>t?.includes(e.name))).length,G=q-J,X=()=>({userId:localStorage.getItem("userId")||"302",transactionId:Date.now().toString(),timestamp:(new Date).toISOString()}),Q=r.useCallback(((e,t)=>{M((s=>({...s,[e]:t})))}),[]),z=r.useCallback((()=>{P(!1),_(!1),M({name:"",value:""}),H(null)}),[]),Y=r.useCallback((()=>{M({name:"",value:""}),P(!0)}),[]),B=r.useCallback((e=>{M({name:e.name||"",value:e.value||""}),H(e),_(!0)}),[]),Z=r.useCallback((e=>{p(e)}),[]),ee=async()=>{if(U)try{E(!0);const e=await i(`/api/v1/variables/${U}`);if("200"===e.result?.code){const t=e.result.data||[];u(Array.isArray(t)?t:[])}else e.result,u([])}catch(e){e.message.includes("404")||e.message.toLowerCase().includes("not found")||l.error("Could not load existing variables, but you can still create new ones"),u([])}finally{E(!1),w(!0)}else w(!0)},te=async(e,t="")=>{try{const s={requestMetaData:X(),data:{name:e.trim(),value:t.trim(),source:"STATIC",testCase:{testCaseId:U}}},a=await i("/api/v1/variables","POST",s);if("200"===a.result?.code)return a.result.data;throw new Error(a.result?.message||"Failed to create variable")}catch(s){throw s}},se=async()=>{const{name:e,value:t}=$;if(!e.trim())return void l.error("Variable name is required");if(d.find((t=>t.name.toLowerCase()===e.trim().toLowerCase()&&(!F||t.variableId!==F.variableId))))l.error("A variable with this name already exists");else try{E(!0),F?(await(async(e,t,s)=>{try{const a={requestMetaData:X(),data:{variableId:e,name:t.trim(),value:s.trim(),source:"STATIC",testCase:{testCaseId:U}}},r=await i("/api/v1/variables","PUT",a);if("200"===r.result?.code)return r.result.data;throw new Error(r.result?.message||"Failed to update variable")}catch(a){throw a}})(F.variableId,e,t),l.success("Variable updated successfully")):(await te(e,t),l.success("Variable created successfully")),await ee(),z()}catch(s){l.error(s.message||"Failed to save variable")}finally{E(!1)}};r.useEffect((()=>{U?ee():w(!0)}),[U]);const ae=Math.ceil(d.length/6),re=d.slice(6*(g-1),6*g);return I?e.jsxs("div",{className:"bg-white shadow p-6 rounded-lg mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("h2",{className:"text-md font-semibold flex items-center",children:[e.jsx(f,{className:"mr-2 text-gray-600"}),"Test case configuration"]}),q>0&&e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:[q," parameters detected"]}),G>0&&e.jsxs("span",{className:"bg-amber-100 text-amber-800 text-xs px-2 py-1 rounded-full",children:[G," not created"]}),0===G&&q>0&&e.jsxs("span",{className:"bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full flex items-center",children:[e.jsx(N,{className:"mr-1 h-3 w-3"}),"All parameters created"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[G>0&&e.jsx("button",{onClick:async()=>{if(t&&0!==t.length)if(0!==G){C(!0);try{const s=t.filter((e=>!d.some((t=>t.name===e))));let a=0,r=0;for(const t of s)try{await te(t,""),a++}catch(e){r++}a>0&&(l.success(`Created ${a} parameter variable${a>1?"s":""}`),await ee()),r>0&&l.warning(`Failed to create ${r} parameter${r>1?"s":""}`)}catch(e){l.error("Error creating parameter variables")}finally{C(!1)}}else l.info("All detected parameters already have variables");else l.info("No parameters detected to create")},className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 hover:-translate-y-0.5 transition-all flex items-center",disabled:!U||T||A,children:A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white mr-1"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"mr-1"}),"Create All Parameters (",G,")"]})}),e.jsxs("button",{onClick:Y,className:"px-3 py-1 bg-[#4F46E5] text-white text-sm rounded hover:bg-[#4338CA] hover:-translate-y-0.5 transition-all flex items-center",disabled:!U||T,children:[e.jsx(h,{className:"mr-1"}),"Add Variable"]})]})]}),q>0&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded-md border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900 mb-1",children:["Detected Parameters: ",t.join(", ")]}),e.jsxs("div",{className:"text-xs text-blue-700",children:[J," of ",q," parameters have been created as variables"]})]}),G>0&&e.jsx("div",{className:"text-xs text-blue-600",children:'ðŸ’¡ Use "Create All Parameters" to automatically create variables for all detected parameters'})]})}),0===q&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-md border border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx(f,{className:"inline mr-2"}),"No parameters detected in your test case templates. You can still create variables manually to store reusable values."]})}),e.jsx("div",{className:"flex mb-4 border-b",children:["Variables","Assertions","Functions"].map((t=>e.jsxs("button",{className:"py-2 px-4 font-medium "+(o===t?"border-b-2 border-[#4F46E5] text-[#4F46E5]":"text-gray-500"),onClick:()=>c(t),children:["Assertions"===t&&e.jsx(v,{className:"inline mr-1"}),t,"Variables"===t&&d.length>0&&e.jsx("span",{className:"ml-1 bg-gray-200 text-gray-700 text-xs px-1.5 py-0.5 rounded-full",children:d.length}),"Assertions"===t&&m.length>0&&e.jsx("span",{className:"ml-1 bg-gray-200 text-gray-700 text-xs px-1.5 py-0.5 rounded-full",children:m.length})]},t)))}),"Variables"===o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 text-left text-xs uppercase text-gray-500 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 font-medium",children:"Name"}),e.jsx("th",{className:"p-3 font-medium",children:"Value"}),e.jsx("th",{className:"p-3 font-medium",children:"Type"}),e.jsx("th",{className:"p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:T&&0===d.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-4 text-center",children:e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-[#4F46E5] mr-2"}),"Loading variables..."]})})}):0===re.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-8 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(f,{className:"h-8 w-8 text-gray-300 mb-3"}),e.jsx("div",{className:"text-lg font-medium mb-2",children:"No variables created yet"}),e.jsx("div",{className:"text-sm mb-4",children:U?"Create variables to store reusable values for your test case":"Save the test case first to start creating variables"}),U&&e.jsxs("button",{onClick:Y,className:"px-4 py-2 bg-[#4F46E5] text-white text-sm rounded hover:bg-[#4338CA] hover:-translate-y-0.5 transition-all flex items-center",children:[e.jsx(h,{className:"mr-1"}),"Create Your First Variable"]})]})})}):re.map((s=>{const a=t?.includes(s.name),r=s.value&&""!==s.value.trim();return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium",children:s.name}),a&&e.jsx("span",{className:"ml-2 bg-blue-100 text-blue-700 text-xs px-1.5 py-0.5 rounded-full",children:"Parameter"})]})}),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"truncate max-w-xs",children:r?e.jsx("span",{className:"text-gray-900",children:s.value}):e.jsx("span",{className:"text-gray-400 italic",children:"Empty"})})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"text-xs px-2 py-1 rounded-full "+(a?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:a?"Auto-detected":"Manual"})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>B(s),className:"text-gray-400 hover:text-[#4F46E5] transition-colors",title:"Edit variable",disabled:T,children:e.jsx(y,{size:16})}),e.jsx("button",{onClick:()=>(e=>{L(e),k(!0)})(s),className:"text-gray-400 hover:text-red-500 transition-colors",title:"Delete variable",disabled:T,children:e.jsx(x,{size:16})})]})})]},s.variableId)}))})]})}),(()=>{if(ae<=1)return null;const t=[],s=Math.floor(2.5);let a=Math.max(1,g-s),r=Math.min(ae,a+5-1);r-a<4&&(a=Math.max(1,r-5+1));for(let e=a;e<=r;e++)t.push(e);return e.jsxs("div",{className:"flex justify-end mt-4 space-x-1 text-sm",children:[e.jsx("button",{className:"px-3 py-1 border rounded hover:bg-gray-100 hover:-translate-y-0.5 disabled:opacity-40 disabled:hover:transform-none transition-all",disabled:1===g,onClick:()=>b(g-1),children:"Prev"}),a>1&&e.jsx("span",{className:"px-2",children:"..."}),t.map((t=>e.jsx("button",{onClick:()=>b(t),className:"px-3 py-1 rounded hover:-translate-y-0.5 transition-all "+(t===g?"bg-[#4F46E5] text-white":"border hover:bg-gray-100"),children:t},t))),r<ae&&e.jsx("span",{className:"px-2",children:"..."}),e.jsx("button",{className:"px-3 py-1 border rounded hover:bg-gray-100 hover:-translate-y-0.5 disabled:opacity-40 disabled:hover:transform-none transition-all",disabled:g===ae,onClick:()=>b(g+1),children:"Next"})]})})()]}),"Assertions"===o&&e.jsx("div",{className:"mt-4",children:e.jsx(W,{testCaseId:U,onAssertionsChange:Z})}),"Functions"===o&&e.jsxs("div",{className:"mt-4 p-8 text-center text-gray-500 bg-gray-50 rounded-md",children:[e.jsx(f,{className:"h-8 w-8 text-gray-300 mb-3 mx-auto"}),e.jsx("div",{className:"text-lg font-medium mb-2",children:"Functions Coming Soon"}),e.jsx("div",{className:"text-sm",children:"Function management will be available in a future update."})]}),e.jsx(K,{isOpen:O,isEdit:!1,formData:$,onFormChange:Q,onSave:se,onClose:z,loading:T,detectedParameters:t}),e.jsx(K,{isOpen:R,isEdit:!0,formData:$,onFormChange:Q,onSave:se,onClose:z,loading:T,detectedParameters:t}),e.jsx(S,{isOpen:V,onClose:()=>{k(!1),L(null)},title:"Delete Variable",size:"sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center w-12 h-12 rounded-full bg-red-100 mb-4",children:e.jsx(x,{className:"w-6 h-6 text-red-600"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Delete Variable"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-6",children:['Are you sure you want to delete "',D?.name,'"? This action cannot be undone.']}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:()=>{k(!1),L(null)},className:"px-4 py-2 border border-gray-300 rounded-md text-sm hover:bg-gray-50 hover:-translate-y-0.5 transition-all",disabled:T,children:"Cancel"}),e.jsxs("button",{onClick:async()=>{if(D)try{E(!0),await(async e=>{try{const t=await i(`/api/v1/variables/${e}`,"DELETE");if("200"===t.result?.code)return!0;throw new Error(t.result?.message||"Failed to delete variable")}catch(t){throw t}})(D.variableId),l.success("Variable deleted successfully"),await ee()}catch(e){l.error(e.message||"Failed to delete variable")}finally{E(!1),k(!1),L(null)}},className:"px-4 py-2 bg-red-600 text-white text-sm rounded-md hover:bg-red-700 hover:-translate-y-0.5 transition-all flex items-center",disabled:T,children:[T&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Delete"]})]})]})})]}):e.jsx("div",{className:"bg-white shadow p-6 rounded-lg mt-8",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mr-3"}),e.jsx("span",{className:"text-gray-600",children:"Loading configuration..."})]})})},ee=()=>{const l=s();a();const[i,o]=r.useState([]),[c,d]=r.useState(!1),[u,m]=r.useState(null),[p,x]=r.useState(!1),h=r.useMemo((()=>l.state?.testCase),[l.state?.testCase]),g=r.useMemo((()=>!!h),[h]),b=r.useMemo((()=>h?.testCaseId),[h?.testCaseId]),y=r.useCallback((e=>{o(e||[]),x(!0)}),[]),f=r.useCallback(((e,t=[])=>{m(e),d(!0),o(t||[]),x(!0)}),[]),N=r.useCallback((e=>{if(!e)return[];const t=/\$\{([^}]+)\}/g,s=[];let a;for(;null!==(a=t.exec(e));)s.push(a[1]);return s}),[]);return t.useEffect((()=>{if(g&&b){m(b),d(!0),x(!0);const e=[];if(h.url){const t=N(h.url);e.push(...t)}if(h.requestTemplate){const t=N(JSON.stringify(h.requestTemplate));e.push(...t)}if(h.responseTemplate){const t=N(JSON.stringify(h.responseTemplate));e.push(...t)}const t=[...new Set(e)];o(t)}}),[g,b,h,N]),e.jsxs("div",{className:"p-6",children:[e.jsx(n,{items:[{label:"Test Design"},{label:"Test Case",path:"/test-design/test-case"},{label:g?"Edit":"Create"}]}),e.jsx(D,{onParametersDetected:y,onTestCaseSaved:f}),(p||c||g)&&e.jsx(Z,{detectedParameters:i,testCaseId:u||b},`config-${u||b}`)]})};export{ee as default};
