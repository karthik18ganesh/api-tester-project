import{j as e}from"./chunk-D8bRv3Ag.js";import{r as s,u as t}from"./chunk-C74fWxxE.js";import{X as a,Y as r,Z as n,A as i,x as d,_ as l,$ as o,a0 as c,F as x,a1 as m,a2 as u,a3 as h,a4 as g,a5 as p,a6 as b,a7 as j,a8 as f,a9 as N,aa as y,a as v,ab as w,ac as C,ad as k,ae as S,g as I,af as T}from"../assets/index-DUtqALCq.js";import{y as E}from"./chunk-Dw5YO7VD.js";import{B as P}from"./chunk-Daju2wTE.js";import"./chunk-SnPUoUoO.js";import"./chunk-4QNEI4IN.js";const $=({data:t,onSelect:o,selectedId:c})=>{const[x,m]=s.useState({[t.id]:!0}),u=e=>{if(!e.children||0===e.children.length)return null;if("package"===e.type){const s=e.children.length;let t=0;return e.children.forEach((e=>{e.children&&(t+=e.children.length)})),t>0?`${s} suite${1!==s?"s":""}, ${t} case${1!==t?"s":""}`:`${s} suite${1!==s?"s":""}`}if("suite"===e.type){const s=e.children.length;return s>0?`${s} case${1!==s?"s":""}`:"No test cases"}return null},h=(s,t=0)=>{const g=s.children&&s.children.length>0,p=x[s.id],b=c===s.id,{icon:j,bgColor:f,textColor:N}=(s=>{switch(s){case"root":return{icon:e.jsx(a,{className:"text-gray-600"}),bgColor:"hover:bg-gray-50",textColor:"text-gray-700 font-medium"};case"package":return{icon:e.jsx(l,{className:"text-indigo-600"}),bgColor:"hover:bg-indigo-50",textColor:"text-indigo-700 font-medium"};case"suite":return{icon:e.jsx(d,{className:"text-blue-600"}),bgColor:"hover:bg-blue-50",textColor:"text-blue-700"};case"case":return{icon:e.jsx(i,{className:"text-green-600"}),bgColor:"hover:bg-green-50",textColor:"text-green-700"};default:return{icon:e.jsx(a,{className:"text-gray-500"}),bgColor:"hover:bg-gray-50",textColor:"text-gray-700"}}})(s.type,g);return u(s),e.jsxs("div",{className:""+(t>0?"ml-4":""),children:[e.jsx("div",{className:"flex items-center justify-between p-2.5 rounded-md cursor-pointer transition-all duration-200 group "+(b?"bg-indigo-100 text-indigo-700 shadow-sm border border-indigo-200":`${f} ${N}`),onClick:()=>o(s),children:e.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[g&&e.jsx("button",{className:"p-1 rounded-full hover:bg-white hover:shadow-sm transition-all duration-200 mr-2 "+(p?"rotate-0":"-rotate-90"),onClick:e=>{var t;e.stopPropagation(),t=s.id,m((e=>({...e,[t]:!e[t]})))},children:p?e.jsx(r,{className:"text-gray-400 group-hover:text-gray-600"}):e.jsx(n,{className:"text-gray-400 group-hover:text-gray-600"})}),e.jsx("span",{className:"mr-3 flex-shrink-0",children:j}),e.jsx("span",{className:"flex-1 font-medium text-sm truncate",children:s.name}),"case"!==s.type&&e.jsx("span",{className:"ml-2 text-xs px-2 py-1 rounded-full flex-shrink-0 "+(b?"bg-indigo-200 text-indigo-800":"bg-gray-200 text-gray-600 group-hover:bg-white group-hover:shadow-sm"),children:(()=>{const e=u(s);return null===e?"suite"===s.type?"Empty":"0":e})()})]})}),g&&e.jsx("div",{className:"overflow-hidden transition-all duration-300 "+(p?"max-h-[2000px] opacity-100":"max-h-0 opacity-0"),children:e.jsxs("div",{className:(t<2?"ml-2 border-l border-gray-200 pl-2":"")+" mt-1",children:[s.children.map((e=>h(e,t+1))),"suite"===s.type&&0===s.children.length&&p&&e.jsx("div",{className:"ml-8 py-2 text-xs text-gray-400 italic",children:"No test cases in this suite"}),"package"===s.type&&0===s.children.length&&p&&e.jsx("div",{className:"ml-8 py-2 text-xs text-gray-400 italic",children:"No test suites in this package"})]})})]},s.id)};return t&&t.children&&0!==t.children.length?e.jsxs("div",{className:"border rounded-md p-4 h-full overflow-auto bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-3 border-b border-gray-100",children:[e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:"Test Selection"}),t.children&&t.children.length>0&&e.jsxs("span",{className:"bg-indigo-100 text-indigo-700 text-xs py-1 px-3 rounded-full font-medium",children:[D(t)," items"]})]}),e.jsx("div",{className:"space-y-1",children:t.children&&t.children.length>0?t.children.map((e=>h(e,0))):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(a,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{children:"No test packages found"})]})}),c&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Selected:"}),e.jsx("div",{className:"text-sm font-medium text-gray-700 truncate",children:F(t,c)})]})]}):e.jsxs("div",{className:"border rounded-md p-4 h-full overflow-auto bg-white shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:"Test Selection"})}),e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[e.jsx("div",{className:"bg-gray-100 rounded-full p-4 mb-4",children:e.jsx(a,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Tests Available"}),e.jsx("p",{className:"text-gray-500 max-w-sm",children:"No test packages, suites, or cases are available for execution. Create some test content to get started."})]})]})},D=e=>{let s=0;return e.children&&e.children.length>0&&e.children.forEach((e=>{s+=1,s+=D(e)})),s},F=(e,s)=>{const t=(e,s,a=[])=>{if(e.id===s)return[...a,e.name].join(" > ");if(e.children)for(const r of e.children){const n=t(r,s,[...a,e.name]);if(n)return n}return null};return t(e,s)||"Unknown"},R=({results:s,inProgress:t,onViewDetails:a,onViewAllResults:r})=>{if(!s&&!t)return e.jsxs("div",{className:"border rounded-md bg-white shadow-sm p-6 h-full flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"bg-gray-100 p-4 rounded-full mb-4",children:e.jsx(o,{className:"h-8 w-8 text-gray-400"})}),e.jsx("p",{className:"text-gray-500 font-medium",children:"Select and run a test to see results"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Results will appear here after execution"})]});const n=s||{instanceId:"In Progress",executedBy:"-",environment:"-",executedAt:"-",passedCount:0,failedCount:0,totalTests:0,results:[]},i=n.totalTests||n.results.length,d=i>0?Math.round(n.passedCount/i*100):0,l=n.results.length>0?Math.round(n.results.reduce(((e,s)=>e+parseFloat(s.duration?.replace("ms","")||"0")),0)/n.results.length):0;return e.jsxs("div",{className:"border rounded-md p-5 h-full overflow-auto bg-white shadow-sm",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:"Execution Details"}),e.jsx("div",{className:"px-3 py-1 rounded-md text-white text-sm font-medium shadow-sm "+(t?"bg-yellow-500":n.failedCount>0?"bg-red-500":"bg-green-500"),children:t?"In Progress":n.failedCount>0?"Failed":"Passed"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-5",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500 mb-1",children:[e.jsx(o,{className:"mr-1"})," Instance ID"]}),e.jsx("div",{className:"font-medium text-sm truncate",children:n.instanceId})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500 mb-1",children:[e.jsx(c,{className:"mr-1"})," Executed By"]}),e.jsx("div",{className:"font-medium text-sm truncate",children:n.executedBy})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500 mb-1",children:[e.jsx(x,{className:"mr-1"})," Environment"]}),e.jsx("div",{className:"font-medium text-sm truncate",children:n.environment})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500 mb-1",children:[e.jsx(m,{className:"mr-1"})," Executed At"]}),e.jsx("div",{className:"font-medium text-sm truncate",children:n.executedAt})]})]}),e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Total Tests"}),e.jsx("div",{className:"text-2xl font-bold text-indigo-700",children:i})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Passed"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:n.passedCount})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Failed"}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:n.failedCount})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Success Rate"}),e.jsxs("div",{className:"text-2xl font-bold "+(d>=80?"text-green-600":d>=50?"text-yellow-600":"text-red-600"),children:[d,"%"]})]})]}),i>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[n.passedCount+n.failedCount," / ",i]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsxs("div",{className:"flex h-2 rounded-full overflow-hidden",children:[e.jsx("div",{className:"bg-green-500 transition-all duration-500",style:{width:n.passedCount/i*100+"%"}}),e.jsx("div",{className:"bg-red-500 transition-all duration-500",style:{width:n.failedCount/i*100+"%"}})]})})]})]}),!t&&n.results.length>0&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center text-xs text-blue-600 mb-1",children:[e.jsx(u,{className:"mr-1"})," Avg Duration"]}),e.jsxs("div",{className:"font-medium text-sm text-blue-700",children:[l,"ms"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 border border-purple-100",children:[e.jsxs("div",{className:"flex items-center text-xs text-purple-600 mb-1",children:[e.jsx(h,{className:"mr-1"})," Test Type"]}),e.jsx("div",{className:"font-medium text-sm text-purple-700",children:"package"===n.selectedItem?.type?"Package":"suite"===n.selectedItem?.type?"Suite":"case"===n.selectedItem?.type?"Test Case":"Mixed"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-medium text-md text-gray-700",children:"Test Cases"}),!t&&s?.results.length>0&&e.jsxs("button",{onClick:r,className:"text-xs px-3 py-1 bg-indigo-100 text-indigo-700 hover:bg-indigo-200 rounded-md transition-colors flex items-center",children:[e.jsx("span",{children:"View All Results"}),e.jsx(g,{className:"ml-1 h-3 w-3"})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:t?e.jsxs("div",{className:"p-8 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600 mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Running tests..."}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"This may take a few moments"})]}):s?.results.length>0?e.jsx("div",{className:"divide-y divide-gray-100 max-h-80 overflow-y-auto",children:s.results.map((s=>e.jsxs("div",{className:"p-3 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1 space-x-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(u,{className:"mr-1 h-3 w-3"}),s.duration]}),s.executedBy&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(c,{className:"mr-1 h-3 w-3"}),s.executedBy]}),s.request?.method&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"mr-1 h-3 w-3"}),s.request.method]})]}),s.executionDate&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Executed: ",s.executionDate]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium mr-3 "+("Passed"===s.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:["Passed"===s.status?e.jsx(b,{className:"mr-1 h-3 w-3"}):e.jsx(j,{className:"mr-1 h-3 w-3"}),s.status]}),e.jsx("button",{onClick:()=>a(s.id),className:"px-2 py-1 text-xs bg-gray-100 text-gray-700 hover:bg-gray-200 rounded",children:"View Details"})]})]}),s.assertions&&"Failed"===s.status&&e.jsxs("div",{className:"mt-2 text-xs text-red-600",children:[s.assertions.filter((e=>"Failed"===e.status)).length," assertion(s) failed"]})]},s.id)))}):s?.error?e.jsxs("div",{className:"p-6 text-center text-red-600",children:[e.jsx(j,{className:"h-8 w-8 mx-auto mb-2"}),e.jsx("div",{className:"font-medium",children:"Execution Error"}),e.jsx("div",{className:"text-sm mt-1",children:s.error})]}):e.jsxs("div",{className:"p-6 text-center text-gray-500",children:[e.jsx(p,{className:"h-8 w-8 mx-auto mb-2"}),"No test results available"]})})]})]})},A=({children:t,title:a,defaultOpen:r=!1})=>{const[n,i]=s.useState(r);return e.jsxs("div",{className:"border rounded",children:[e.jsxs("button",{className:"w-full flex items-center justify-between p-3 text-left text-sm font-medium bg-gray-50 focus:outline-none",onClick:()=>i(!n),children:[e.jsx("span",{children:a}),n?e.jsx(v,{className:"h-4 w-4 text-gray-500"}):e.jsx(N,{className:"h-4 w-4 text-gray-500"})]}),n&&e.jsx("div",{className:"p-3 border-t",children:t})]})},B=({executionId:t,testCases:a,currentTestCaseId:r,onNavigate:n,onBack:i})=>{const[d,l]=s.useState(null);s.useEffect((()=>{if(!a||0===a.length)return;const e=a.findIndex((e=>e.id===r));-1!==e&&l(a[e])}),[a,r]);const o=e=>{if(!a||0===a.length)return;const s=a.findIndex((e=>e.id===r));if(-1===s)return;let i;i="next"===e?(s+1)%a.length:(s-1+a.length)%a.length,n(t,a[i].id)},c=e=>JSON.stringify(e,null,2);if(!d)return e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"text-gray-500 p-10",children:"Test case not found"}),e.jsx("button",{onClick:i,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors",children:"Go Back"})]});const x=(()=>{if(!d?.assertions||0===d.assertions.length)return 0;const e=d.assertions.filter((e=>"Passed"===e.status)).length;return Math.round(e/d.assertions.length*100)})();return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:i,className:"flex items-center text-indigo-600 hover:text-indigo-800 transition-colors",children:[e.jsx(f,{className:"mr-2"}),"Back to Execution"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>o("prev"),className:"p-2 rounded-md border border-gray-200 hover:bg-gray-50 text-gray-600",title:"Previous test case",children:e.jsx(f,{size:14})}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Test ",a.findIndex((e=>e.id===r))+1," of ",a.length]}),e.jsx("button",{onClick:()=>o("next"),className:"p-2 rounded-md border border-gray-200 hover:bg-gray-50 text-gray-600",title:"Next test case",children:e.jsx(N,{size:14})})]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-1 text-gray-800",children:d.name}),e.jsxs("p",{className:"text-gray-600",children:["Execution ID: ",t]})]}),e.jsx("div",{className:`px-3 py-1 rounded-md text-white ${"Passed"===d.status?"bg-green-500":"bg-red-500"} shadow-sm`,children:d.status})]}),e.jsx("div",{className:"mb-6 bg-gray-100 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:`h-full ${"Passed"===d.status?"bg-green-500":"bg-red-500"} transition-all duration-500 ease-in-out`,style:{width:`${x}%`}})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"border rounded-lg shadow-sm p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:"Request"}),e.jsx("span",{className:"bg-indigo-100 text-indigo-700 text-xs px-2 py-1 rounded-full",children:d.request?.method||"GET"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"URL"}),e.jsx("div",{className:"bg-gray-50 p-2 rounded border border-gray-100 font-mono text-sm break-all",children:d.request?.url||"No URL provided"})]}),d.request?.headers&&e.jsx("div",{className:"mb-3",children:e.jsx(A,{title:"Headers",defaultOpen:!1,children:e.jsx("pre",{className:"bg-gray-50 p-3 rounded font-mono text-sm overflow-auto border border-gray-100 max-h-60",children:c(d.request.headers)})})}),d.request?.body&&e.jsx("div",{children:e.jsx(A,{title:"Request Body",defaultOpen:!1,children:e.jsx("pre",{className:"bg-gray-50 p-3 rounded font-mono text-sm overflow-auto border border-gray-100 max-h-60",children:c(d.request.body)})})})]}),e.jsxs("div",{className:"border rounded-lg shadow-sm p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:"Response"}),e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full "+(d.response?.status>=200&&d.response?.status<300?"bg-green-100 text-green-800":d.response?.status>=400?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:["Status: ",d.response?.status||"Unknown"]})]}),d.response?.data&&e.jsx("div",{children:e.jsx(A,{title:"Response Body",defaultOpen:!0,children:e.jsx("pre",{className:"bg-gray-50 p-3 rounded font-mono text-sm overflow-auto border border-gray-100 max-h-60",children:c(d.response.data)})})}),d.response?.headers&&e.jsx("div",{className:"mt-3",children:e.jsx(A,{title:"Response Headers",defaultOpen:!1,children:e.jsx("pre",{className:"bg-gray-50 p-3 rounded font-mono text-sm overflow-auto border border-gray-100 max-h-60",children:c(d.response.headers)})})})]})]}),e.jsxs("div",{className:"border rounded-lg shadow-sm overflow-hidden bg-white",children:[e.jsx("div",{className:"bg-gray-50 p-4 border-b",children:e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:"Assertions"})}),e.jsxs("div",{className:"divide-y divide-gray-100",children:[d.assertions&&d.assertions.map((s=>e.jsx("div",{className:"p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"mt-0.5 rounded-full p-1 mr-3 "+("Passed"===s.status?"bg-green-100 text-green-600":"bg-red-100 text-red-600"),children:"Passed"===s.status?e.jsx(b,{className:"h-4 w-4"}):e.jsx(j,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["Assertion #",s.id]}),e.jsx("div",{className:"text-gray-600 mt-1",children:s.description}),"Passed"!==s.status&&s.error&&e.jsx("div",{className:"mt-2 bg-red-50 text-red-700 p-2 rounded text-sm border border-red-100",children:s.error})]})]}),e.jsx("div",{children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("Passed"===s.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:s.status})})]})},s.id))),(!d.assertions||0===d.assertions.length)&&e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No assertions found for this test case"})]})]}),d.snippets&&e.jsxs("div",{className:"mt-6 border rounded-lg shadow-sm overflow-hidden bg-white",children:[e.jsxs("div",{className:"bg-gray-50 p-4 border-b flex items-center",children:[e.jsx(y,{className:"text-gray-500 mr-2"}),e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:"Code Snippets"})]}),e.jsx("div",{className:"p-4",children:e.jsx(A,{title:"Test Code",defaultOpen:!1,children:e.jsx("pre",{className:"bg-gray-50 p-3 rounded font-mono text-sm overflow-auto border border-gray-100",children:d.snippets.testCode||"// No test code available"})})})]})]})},O=()=>{const a=t(),[r,n]=s.useState(null),[i,d]=s.useState(!1),[l,o]=s.useState(null),[c,x]=s.useState(!1),[m,u]=s.useState({environment:"Staging",stopOnFailure:!1,notifyOnCompletion:!0,retryCount:1}),[h,g]=s.useState("execution"),[p,b]=s.useState(null),[j,f]=s.useState(null),[N,y]=s.useState(!0),[D,F]=s.useState(null),A=async()=>{y(!0),F(null);try{const e=await I("/api/v1/packages/hierarchy","GET");let s;if(Array.isArray(e))s=e;else if(e&&e.result&&e.result.data)s=e.result.data;else{if(!e||!Array.isArray(e.data))return void F("Invalid response format from server");s=e.data}if(!Array.isArray(s))return void F("Invalid data format - expected array of packages");const t={id:"root",type:"root",name:"All Test Packages",children:s.map((e=>({id:`package-${e.id}`,type:"package",name:e.packageName,packageId:e.id,children:(e.testSuites||[]).map((e=>({id:`suite-${e.id}`,type:"suite",name:e.suiteName,suiteId:e.id,children:(e.testCases||[]).map((e=>({id:`case-${e.id}`,type:"case",name:e.caseName,caseId:e.id,children:[]})))})))})))};f(t)}catch(e){F(e.message||"Failed to load test hierarchy")}finally{y(!1)}},O=e=>{if(!e)return(new Date).toLocaleString();try{return new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch(s){return(new Date).toLocaleString()}};s.useEffect((()=>{A()}),[]);const q=()=>{const e=[{label:"Test Execution"}];return"execution"===h?e.push({label:"Execute Tests"}):"testcase"===h&&l&&e.push({label:"Execute Tests",path:"/test-execution"},{label:`Execution ${l.id}`},{label:"Test Case Details"}),e},M=(e,s)=>{b(s),window.history.pushState(null,"",`/test-execution/results/${e}/${s}`)},L=()=>{g("execution"),b(null),window.history.pushState(null,"","/test-execution")},H=(e,s)=>{u({...m,[e]:s})};return"testcase"===h&&l?e.jsxs("div",{className:"p-6 font-inter text-gray-800",children:[e.jsx(P,{items:q()}),e.jsx(B,{executionId:l.id,testCases:l.results,currentTestCaseId:p,onNavigate:M,onBack:L})]}):e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsx(P,{items:q()}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-1",children:"Test Execution"}),e.jsx("p",{className:"text-gray-600",children:"Run test packages, suites, or individual cases"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>x(!c),className:"flex items-center gap-1 px-3 py-2 bg-white text-gray-700 rounded-md border border-gray-200 hover:bg-gray-50 transition-colors",children:[e.jsx(w,{className:"text-gray-500"}),e.jsx("span",{children:"Settings"}),e.jsx(v,{className:"ml-1 text-gray-400 transition-transform "+(c?"rotate-180":"")})]}),c&&e.jsxs("div",{className:"absolute right-0 mt-1 w-64 bg-white rounded-md shadow-lg border border-gray-200 z-10 animate-fade-in",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsx("h3",{className:"font-medium text-gray-700",children:"Execution Settings"})}),e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Environment"}),e.jsxs("select",{value:m.environment,onChange:e=>H("environment",e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-1 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"Development",children:"Development"}),e.jsx("option",{value:"Staging",children:"Staging"}),e.jsx("option",{value:"Production",children:"Production"})]})]}),e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("input",{type:"checkbox",id:"stopOnFailure",checked:m.stopOnFailure,onChange:e=>H("stopOnFailure",e.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"stopOnFailure",className:"ml-2 block text-sm text-gray-700",children:"Stop on first failure"})]}),e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("input",{type:"checkbox",id:"notifyOnCompletion",checked:m.notifyOnCompletion,onChange:e=>H("notifyOnCompletion",e.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"notifyOnCompletion",className:"ml-2 block text-sm text-gray-700",children:"Notify on completion"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Retry Count"}),e.jsx("input",{type:"number",min:"0",max:"5",value:m.retryCount,onChange:e=>H("retryCount",parseInt(e.target.value)),className:"w-20 border border-gray-300 rounded-md px-3 py-1 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]})]})]})]}),e.jsx("button",{onClick:i?null:async()=>{if(r){d(!0),o(null);try{const e=localStorage.getItem("userId")||"current.user",s=(e=>{switch(e.type){case"package":return{method:T.executePackage,id:e.packageId,name:"Package"};case"suite":return{method:T.executeSuite,id:e.suiteId,name:"Suite"};case"case":return{method:T.executeTestCase,id:e.caseId,name:"Test Case"};default:throw new Error("Invalid selection type for execution")}})(r),t=await s.method(s.id,e),a=(e=>{const s=(e.testCaseResult||[]).map((s=>{const t="PASSED"===s.executionStatus;return{id:`tc-${s.testCaseId}`,name:s.testCaseName||`Test Case ${s.testCaseId}`,status:t?"Passed":"Failed",duration:`${s.executionTimeMs}ms`,request:{method:s.httpMethod,url:s.url,headers:s.requestHeaders||{},body:s.requestBody},response:{status:s.statusCode,data:s.responseBody,headers:s.responseHeaders||{}},assertions:[{id:1,description:`HTTP ${s.httpMethod} request validation`,status:t?"Passed":"Failed",...s.errorMessage&&{error:s.errorMessage}},{id:2,description:"Response status validation",status:s.statusCode>=200&&s.statusCode<300?"Passed":"Failed",...s.statusCode>=400&&{error:`HTTP ${s.statusCode} error response`}}],executionId:s.resultId,testCaseId:s.testCaseId,executedBy:e.executedBy,executionDate:O(e.executionDate),testSuiteId:s.testSuiteId,testSuiteName:s.testSuiteName,environment:s.environmentName||e.environmentName}}));return{results:s,passedCount:e.passed||0,failedCount:e.failed||0,errorCount:e.error||0,totalTests:e.totalTests||s.length,executionTime:e.executionTimeMs,successRate:e.successRate,environmentName:e.environmentName,executionStatus:e.executionStatus}})(t),n=`exec-${t.executionId}`,i={id:n,status:"PASSED"===a.executionStatus?"Passed":"Failed",instanceId:n,executedBy:e,environment:a.environmentName||m.environment,executedAt:O(t.executionDate),passedCount:a.passedCount,failedCount:a.failedCount,errorCount:a.errorCount,totalTests:a.totalTests,executionTime:a.executionTime,successRate:a.successRate,results:a.results,rawExecution:t,selectedItem:r,actualExecutionId:t.executionId};o(i),window.mockExecutionData=window.mockExecutionData||{},window.mockExecutionData[n]=i,E.success(`${s.name} execution completed: ${a.passedCount} passed, ${a.failedCount} failed`)}catch(e){E.error(`Execution failed: ${e.message}`);const s=`exec-${Date.now()}-error`,t={id:s,status:"Failed",instanceId:s,executedBy:localStorage.getItem("userId")||"current.user",environment:m.environment,executedAt:(new Date).toLocaleString(),passedCount:0,failedCount:1,totalTests:1,results:[{id:"error-case",name:"Execution Error",status:"Failed",duration:"0ms",request:{method:"UNKNOWN",url:r?.name||"Unknown",headers:{},body:{}},response:{status:0,data:{error:e.message},headers:{}},assertions:[{id:1,description:"Execution attempt",status:"Failed",error:e.message}]}],error:e.message};o(t)}finally{d(!1)}}},disabled:!r||i,className:"flex items-center px-4 py-2 rounded-md text-white shadow-sm transition-colors "+(!r||i?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"),children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Running..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2"}),"Run ","package"===r?.type?"Package":"suite"===r?.type?"Suite":"case"===r?.type?"Test Case":"Selection"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-[calc(100vh-200px)]",children:N?e.jsxs("div",{className:"border rounded-md p-4 h-full bg-white shadow-sm flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading test hierarchy..."}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Please wait while we fetch your test structure"})]}):D?e.jsxs("div",{className:"border rounded-md p-6 h-full bg-white shadow-sm flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"bg-red-100 rounded-full p-4 mb-4",children:e.jsx(k,{className:"h-8 w-8 text-red-600"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Failed to Load Test Hierarchy"}),e.jsx("p",{className:"text-gray-600 mb-4 max-w-md",children:"Invalid response format from server"===D?"The server returned an unexpected response format. Please contact your administrator.":D}),e.jsxs("button",{onClick:()=>{A()},className:"flex items-center px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Retry"]})]}):!j||j.children&&0===j.children.length?e.jsxs("div",{className:"border rounded-md p-6 h-full bg-white shadow-sm flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"bg-gray-100 rounded-full p-4 mb-4",children:e.jsx("svg",{className:"h-8 w-8 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Test Packages Found"}),e.jsx("p",{className:"text-gray-600 mb-4 max-w-md",children:"You don't have any test packages created yet. Create test packages, suites, and cases to start running tests."}),e.jsx("button",{onClick:()=>a("/test-design/test-package"),className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors",children:"Create Test Package"})]}):e.jsx($,{data:j,onSelect:e=>{n(e)},selectedId:r?.id})}),e.jsx("div",{className:"h-[calc(100vh-200px)]",children:e.jsx(R,{results:l,inProgress:i,onViewDetails:e=>{b(e),g("testcase"),l&&window.history.pushState(null,"",`/test-execution/results/${l.id}/${e}`)},onViewAllResults:()=>{l&&(window.mockExecutionData=window.mockExecutionData||{},window.mockExecutionData[l.id]=l,a("/test-results"))}})})]})]})};export{O as default};
